"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[665],{8665:(ft,I,s)=>{s.r(I),s.d(I,{HealthCheckComponent:()=>g,JobListComponent:()=>u,JobStateLabelComponent:()=>h,SystemModule:()=>v,systemRoutes:()=>$});var t=s(5220),r=s(1139),m=s(2769),l=s(1133),d=s(8074),f=s(7482),T=s(6292),_=s(3312),F=s(1542),C=s(552),R=s(5888),y=s(647),k=s(1470);const M=(n,a)=>({"is-success":n,"is-danger":a});function J(n,a){1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"system.health-all-systems-up")," "))}function N(n,a){1&n&&(t.EFF(0),t.nI1(1,"translate")),2&n&&t.SpI(" ",t.bMT(1,1,"system.health-error")," ")}function D(n,a){if(1&n&&(t.j41(0,"div",9)(1,"div",10),t.nrm(2,"clr-icon",11),t.k0s(),t.j41(3,"div",12),t.DNE(4,J,3,3,"ng-container",13)(5,N,2,3,"ng-template",null,0,t.C5r),t.j41(7,"div",14),t.EFF(8),t.nI1(9,"translate"),t.nI1(10,"async"),t.nI1(11,"localeDate"),t.k0s()()()),2&n){const e=a.ngIf,o=t.sdS(6),i=t.XpG();t.R7$(2),t.Y8G("ngClass",t.l_i(13,M,"ok"===e,"ok"!==e)),t.BMQ("shape","ok"===e?"check-circle":"exclamation-circle"),t.R7$(2),t.Y8G("ngIf","ok"===e)("ngIfElse",o),t.R7$(4),t.Lme(" ",t.bMT(9,6,"system.health-last-checked"),": ",t.i5U(11,10,t.bMT(10,8,i.healthCheckService.lastCheck$),"mediumTime")," ")}}function S(n,a){1&n&&(t.qex(0),t.nrm(1,"clr-icon",17),t.EFF(2),t.nI1(3,"translate"),t.bVm()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"system.health-status-up")," "))}function L(n,a){1&n&&(t.nrm(0,"clr-icon",18),t.EFF(1),t.nI1(2,"translate")),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"system.health-status-down")," "))}function Y(n,a){if(1&n&&(t.j41(0,"tr")(1,"td",15),t.EFF(2),t.k0s(),t.j41(3,"td",15)(4,"vdr-chip",16),t.DNE(5,S,4,3,"ng-container",13)(6,L,3,3,"ng-template",null,1,t.C5r),t.k0s()(),t.j41(8,"td",15),t.EFF(9),t.k0s()()),2&n){const e=a.$implicit,o=t.sdS(7);t.R7$(2),t.JRh(e.key),t.R7$(2),t.Y8G("colorType","up"===e.result.status?"success":"error"),t.R7$(),t.Y8G("ngIf","up"===e.result.status)("ngIfElse",o),t.R7$(4),t.JRh(e.result.message)}}class g{constructor(a){this.healthCheckService=a}static#t=this.\u0275fac=function(e){return new(e||g)(t.rXU(r.MNd))};static#e=this.\u0275cmp=t.VBU({type:g,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["error",""],["down",""],["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["shape","check-circle"],["shape","exclamation-circle"]],template:function(e,o){1&e&&(t.j41(0,"vdr-page-header"),t.nrm(1,"vdr-page-title"),t.k0s(),t.j41(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),t.DNE(6,D,12,16,"div",2),t.nI1(7,"async"),t.k0s(),t.j41(8,"vdr-ab-right"),t.nrm(9,"vdr-action-bar-items",3),t.j41(10,"button",4),t.bIt("click",function(){return o.healthCheckService.refresh()}),t.nrm(11,"clr-icon",5),t.EFF(12),t.nI1(13,"translate"),t.k0s()()()(),t.j41(14,"vdr-page-block")(15,"table",6)(16,"thead")(17,"tr")(18,"th",7),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"th",7),t.EFF(22),t.nI1(23,"translate"),t.k0s(),t.j41(24,"th",7),t.EFF(25),t.nI1(26,"translate"),t.k0s()()(),t.j41(27,"tbody"),t.DNE(28,Y,10,5,"tr",8),t.nI1(29,"async"),t.k0s()()()()),2&e&&(t.R7$(6),t.Y8G("ngIf",t.bMT(7,6,o.healthCheckService.status$)),t.R7$(6),t.SpI(" ",t.bMT(13,8,"system.health-refresh")," "),t.R7$(7),t.SpI(" ",t.bMT(20,10,"common.name")," "),t.R7$(3),t.SpI(" ",t.bMT(23,12,"system.health-status")," "),t.R7$(3),t.SpI(" ",t.bMT(26,14,"system.health-message")," "),t.R7$(3),t.Y8G("ngForOf",t.bMT(29,16,o.healthCheckService.details$)))},dependencies:[m.U4n,l.YU,l.Sq,l.bT,d.nG,d.wL,d.TX,f.w,T.T,_.y,F.j,C.D,R.e,l.Jj,y.D9,k.P],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-inline-end:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0})}var p=s(4725),P=s(3688),x=s(6893),U=s(5504),H=s(2950),j=s(2703),b=s(2786),w=s(4538),O=s(3120),X=s(568),A=s(6515),V=s(9430),B=s(4128),Q=s(4709),Z=s(3202);function z(n,a){if(1&n&&(t.j41(0,"span",3),t.EFF(1),t.nI1(2,"percent"),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,e.job.progress/100)," ")}}class h{get iconShape(){switch(this.job.state){case r.dqH.COMPLETED:return"check-circle";case r.dqH.FAILED:return"exclamation-circle";case r.dqH.CANCELLED:return"ban";case r.dqH.PENDING:case r.dqH.RETRYING:return"hourglass";case r.dqH.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case r.dqH.COMPLETED:return"success";case r.dqH.FAILED:case r.dqH.CANCELLED:return"error";case r.dqH.PENDING:case r.dqH.RETRYING:return"";case r.dqH.RUNNING:return"warning"}}static#t=this.\u0275fac=function(e){return new(e||h)};static#e=this.\u0275cmp=t.VBU({type:h,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(e,o){1&e&&(t.j41(0,"vdr-chip",0),t.nrm(1,"clr-icon",1),t.EFF(2),t.nI1(3,"titlecase"),t.DNE(4,z,3,3,"span",2),t.k0s()),2&e&&(t.Y8G("colorType",o.colorType),t.R7$(),t.BMQ("shape",o.iconShape),t.R7$(),t.SpI(" ",t.bMT(3,4,o.job.state)," "),t.R7$(2),t.Y8G("ngIf","RUNNING"===o.job.state))},dependencies:[m.U4n,l.bT,f.w,l.m1,l.PV],styles:[".progress[_ngcontent-%COMP%]{margin-inline-start:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0})}var q=s(5505),K=s(4646),W=s(9653);const tt=()=>["DeleteSettings","DeleteSystem"];function et(n,a){1&n&&(t.qex(0),t.j41(1,"vdr-chip"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"system.all-job-queues")))}function nt(n,a){if(1&n&&(t.j41(0,"vdr-chip",20),t.EFF(1),t.k0s()),2&n){const e=t.XpG().item;t.Y8G("colorFrom",e.name),t.R7$(),t.JRh(e.name)}}function at(n,a){if(1&n&&t.DNE(0,et,4,3,"ng-container",19)(1,nt,2,2,"ng-template",null,0,t.C5r),2&n){const e=a.item,o=t.sdS(2);t.Y8G("ngIf","all"===e.name)("ngIfElse",o)}}function st(n,a){if(1&n&&t.EFF(0),2&n){const e=a.item;t.SpI(" ",e.id," ")}}function ot(n,a){if(1&n&&(t.EFF(0),t.nI1(1,"timeAgo")),2&n){const e=a.item;t.SpI(" ",t.bMT(1,1,e.createdAt)," ")}}function rt(n,a){if(1&n&&(t.j41(0,"vdr-chip",20),t.EFF(1),t.k0s()),2&n){const e=a.item;t.Y8G("colorFrom",e.queueName),t.R7$(),t.JRh(e.queueName)}}function it(n,a){if(1&n&&(t.j41(0,"vdr-dropdown")(1,"button",22),t.nI1(2,"translate"),t.nrm(3,"clr-icon",23),t.k0s(),t.j41(4,"vdr-dropdown-menu")(5,"div",24),t.nrm(6,"vdr-object-tree",5),t.k0s()()()),2&n){const e=t.XpG().item;t.R7$(),t.Y8G("title",t.bMT(2,2,"system.job-data")),t.R7$(5),t.Y8G("value",e.data)}}function lt(n,a){if(1&n&&t.DNE(0,it,7,4,"vdr-dropdown",21),2&n){const e=a.item;t.Y8G("ngIf",e.data)}}function ct(n,a){if(1&n&&(t.j41(0,"div",27),t.EFF(1),t.k0s()),2&n){const e=t.XpG().item;t.R7$(),t.SpI("after ",e.attempts," attempts")}}function mt(n,a){if(1&n&&(t.j41(0,"div",27),t.EFF(1),t.k0s()),2&n){const e=t.XpG().item;t.R7$(),t.Lme(" attempting ",e.attempts," of ",e.retries+1," ")}}function dt(n,a){if(1&n&&(t.nrm(0,"vdr-job-state-label",25),t.DNE(1,ct,2,1,"div",26)(2,mt,2,2,"div",26)),2&n){const e=a.item;t.Y8G("job",e),t.R7$(),t.Y8G("ngIf","FAILED"===e.state),t.R7$(),t.Y8G("ngIf","RUNNING"===e.state||"RETRYING"===e.state)}}function pt(n,a){if(1&n&&(t.EFF(0),t.nI1(1,"duration")),2&n){const e=a.item;t.SpI(" ",t.bMT(1,1,e.duration)," ")}}function gt(n,a){if(1&n&&(t.j41(0,"vdr-dropdown")(1,"button",28),t.nrm(2,"clr-icon",23),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"vdr-dropdown-menu")(6,"div",24),t.nrm(7,"vdr-object-tree",5),t.k0s()()()),2&n){const e=t.XpG().item;t.R7$(3),t.SpI(" ",t.bMT(4,2,"system.job-result")," "),t.R7$(4),t.Y8G("value",e.result)}}function ht(n,a){if(1&n&&(t.j41(0,"vdr-dropdown")(1,"button",29),t.nrm(2,"clr-icon",30),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"vdr-dropdown-menu")(6,"div",24),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG().item;t.R7$(3),t.SpI(" ",t.bMT(4,2,"system.job-error")," "),t.R7$(4),t.SpI(" ",e.error," ")}}function ut(n,a){if(1&n){const e=t.RV6();t.j41(0,"vdr-dropdown")(1,"button",31),t.nrm(2,"clr-icon",32),t.k0s(),t.j41(3,"vdr-dropdown-menu",33)(4,"button",34),t.nI1(5,"hasPermission"),t.bIt("click",function(){t.eBV(e);const i=t.XpG().item,c=t.XpG();return t.Njj(c.cancelJob(i.id))}),t.nrm(6,"clr-icon",35),t.EFF(7),t.nI1(8,"translate"),t.k0s()()()}2&n&&(t.R7$(4),t.Y8G("disabled",!t.bMT(5,2,t.lJ4(6,tt))),t.R7$(3),t.SpI(" ",t.bMT(8,4,"common.cancel")," "))}function bt(n,a){if(1&n&&t.DNE(0,gt,8,4,"vdr-dropdown",21)(1,ht,8,4,"vdr-dropdown",21)(2,ut,9,7,"vdr-dropdown",21),2&n){const e=a.item,o=t.XpG();t.Y8G("ngIf",o.hasResult(e)),t.R7$(),t.Y8G("ngIf",e.error),t.R7$(),t.Y8G("ngIf",!e.isSettled&&"FAILED"!==e.state)}}class u extends r.pDf{constructor(a,e,o){super(e,o),this.dataService=a,this.liveUpdate=new p.MJ(!0),this.queueFilter=new p.MJ("all"),this.stateFilter=new p.MJ(""),super.setQueryFn((...i)=>this.dataService.settings.getAllJobs(...i),i=>i.jobs,(i,c)=>{const vt="all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},G=this.stateFilter.value;return{options:{skip:i,take:c,filter:{...vt,...G?{state:{eq:G}}:{}},sort:{createdAt:r.xBQ.DESC}}}})}ngOnInit(){super.ngOnInit(),(0,P.O)(5e3,2e3).pipe((0,x.Q)(this.destroy$),(0,U.p)(()=>!!this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(a=>a.jobQueues).pipe((0,H.T)(a=>[{name:"all",running:!0},...a]))}hasResult(a){const e=a.result;return null!=e&&("object"!=typeof e||Object.keys(e).length>0)}cancelJob(a){this.dataService.settings.cancelJob(a).subscribe(()=>this.refresh())}static#t=this.\u0275fac=function(e){return new(e||u)(t.rXU(r.uSP),t.rXU(j.Ix),t.rXU(j.nX))};static#e=this.\u0275cmp=t.VBU({type:u,selectors:[["vdr-job-list"]],features:[t.Vt3],decls:67,vars:80,consts:[["others",""],[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["locationId","job-list"],[1,"mr-2",3,"change","addTag","hideSelected","multiple","markFirst","clearable","searchable","formControl"],[3,"value"],["colorType","warning"],["colorType","success"],["colorType","error"],["bindValue","name",3,"change","addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"pageChange","itemsPerPageChange","items","itemsPerPage","totalItems","currentPage"],["id","id",3,"heading"],["id","created-at",3,"heading"],["id","job-queue-name",3,"heading","optional"],["id","job-data",3,"heading","optional"],["id","job-state",3,"heading"],["id","job-duration",3,"heading"],["id","job-result",3,"heading"],[4,"ngIf","ngIfElse"],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"button-small",3,"title"],["shape","details"],[1,"result-detail"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"button-small","mr-1"],["vdrDropdownTrigger","",1,"button-small"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click","disabled"],["shape","ban",1,"is-danger"]],template:function(e,o){1&e&&(t.j41(0,"vdr-page-header"),t.nrm(1,"vdr-page-title"),t.k0s(),t.j41(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",1),t.nrm(7,"input",2),t.j41(8,"label"),t.EFF(9),t.nI1(10,"translate"),t.k0s()()(),t.j41(11,"vdr-ab-right"),t.nrm(12,"vdr-action-bar-items",3),t.j41(13,"ng-select",4),t.bIt("change",function(){return o.refresh()}),t.j41(14,"ng-option",5)(15,"vdr-chip"),t.EFF(16),t.nI1(17,"translate"),t.k0s()(),t.j41(18,"ng-option",5)(19,"vdr-chip"),t.EFF(20),t.nI1(21,"translate"),t.k0s()(),t.j41(22,"ng-option",5)(23,"vdr-chip",6),t.EFF(24),t.nI1(25,"translate"),t.k0s()(),t.j41(26,"ng-option",5)(27,"vdr-chip",7),t.EFF(28),t.nI1(29,"translate"),t.k0s()(),t.j41(30,"ng-option",5)(31,"vdr-chip",8),t.EFF(32),t.nI1(33,"translate"),t.k0s()(),t.j41(34,"ng-option",5)(35,"vdr-chip",8),t.EFF(36),t.nI1(37,"translate"),t.k0s()()(),t.j41(38,"ng-select",9),t.nI1(39,"async"),t.bIt("change",function(){return o.refresh()}),t.DNE(40,at,3,2,"ng-template",10),t.k0s()()()(),t.j41(41,"vdr-data-table-2",11),t.nI1(42,"async"),t.nI1(43,"async"),t.nI1(44,"async"),t.nI1(45,"async"),t.bIt("pageChange",function(c){return o.setPageNumber(c)})("itemsPerPageChange",function(c){return o.setItemsPerPage(c)}),t.j41(46,"vdr-dt2-column",12),t.nI1(47,"translate"),t.DNE(48,st,1,1,"ng-template"),t.k0s(),t.j41(49,"vdr-dt2-column",13),t.nI1(50,"translate"),t.DNE(51,ot,2,3,"ng-template"),t.k0s(),t.j41(52,"vdr-dt2-column",14),t.nI1(53,"translate"),t.DNE(54,rt,2,2,"ng-template"),t.k0s(),t.j41(55,"vdr-dt2-column",15),t.nI1(56,"translate"),t.DNE(57,lt,1,1,"ng-template"),t.k0s(),t.j41(58,"vdr-dt2-column",16),t.nI1(59,"translate"),t.DNE(60,dt,3,3,"ng-template"),t.k0s(),t.j41(61,"vdr-dt2-column",17),t.nI1(62,"translate"),t.DNE(63,pt,2,3,"ng-template"),t.k0s(),t.j41(64,"vdr-dt2-column",18),t.nI1(65,"translate"),t.DNE(66,bt,3,3,"ng-template"),t.k0s()()()),2&e&&(t.R7$(7),t.Y8G("formControl",o.liveUpdate),t.R7$(2),t.JRh(t.bMT(10,42,"common.live-update")),t.R7$(4),t.Y8G("addTag",!1)("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",o.stateFilter),t.R7$(),t.Y8G("value",""),t.R7$(2),t.JRh(t.bMT(17,44,"system.job-state-all")),t.R7$(2),t.Y8G("value","PENDING"),t.R7$(2),t.JRh(t.bMT(21,46,"system.job-state-pending")),t.R7$(2),t.Y8G("value","RUNNING"),t.R7$(2),t.JRh(t.bMT(25,48,"system.job-state-running")),t.R7$(2),t.Y8G("value","COMPLETED"),t.R7$(2),t.JRh(t.bMT(29,50,"system.job-state-completed")),t.R7$(2),t.Y8G("value","FAILED"),t.R7$(2),t.JRh(t.bMT(33,52,"system.job-state-failed")),t.R7$(2),t.Y8G("value","CANCELLED"),t.R7$(2),t.JRh(t.bMT(37,54,"system.job-state-cancelled")),t.R7$(2),t.Y8G("addTag",!1)("items",t.bMT(39,56,o.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",o.queueFilter),t.R7$(3),t.Y8G("items",t.bMT(42,58,o.items$))("itemsPerPage",t.bMT(43,60,o.itemsPerPage$))("totalItems",t.bMT(44,62,o.totalItems$))("currentPage",t.bMT(45,64,o.currentPage$)),t.R7$(5),t.Y8G("heading",t.bMT(47,66,"common.id")),t.R7$(3),t.Y8G("heading",t.bMT(50,68,"common.created-at")),t.R7$(3),t.Y8G("heading",t.bMT(53,70,"system.job-queue-name"))("optional",!1),t.R7$(3),t.Y8G("heading",t.bMT(56,72,"system.job-data"))("optional",!1),t.R7$(3),t.Y8G("heading",t.bMT(59,74,"system.job-state")),t.R7$(3),t.Y8G("heading",t.bMT(62,76,"system.job-duration")),t.R7$(3),t.Y8G("heading",t.bMT(65,78,"system.job-result")))},dependencies:[m.U4n,m.aZZ,m.Jej,m.eAx,l.bT,p.Zm,p.BC,p.l_,b.vr,b.xt,b.Uq,b.ZZ,d.nG,d.wL,d.TX,f.w,w.V,O.P,X.q,A.j,V.M,B.T,T.T,Q.I,Z.Y,_.y,F.j,C.D,R.e,h,l.Jj,y.D9,q.E,K.n,W.b],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-400)}"],changeDetection:0})}var E=s(4500);const $=[{path:"jobs",component:u,data:{breadcrumb:(0,E.x)("breadcrumb.job-queue")}},{path:"system-status",component:g,data:{breadcrumb:(0,E.x)("breadcrumb.system-status")}}];class v{static#t=this.\u0275fac=function(e){return new(e||v)};static#e=this.\u0275mod=t.$C({type:v});static#n=this.\u0275inj=t.G2t({imports:[r.GgS,j.iI.forChild($)]})}}}]);
//# sourceMappingURL=665.fdfb195afab71249.js.map