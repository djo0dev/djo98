"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[668],{3668:(Lt,k,o)=>{o.r(k),o.d(k,{DEFAULT_DASHBOARD_WIDGET_LAYOUT:()=>U,DEFAULT_WIDGETS:()=>N,DashboardComponent:()=>h,DashboardModule:()=>T,DashboardWidgetComponent:()=>g,GET_ORDER_CHART_DATA:()=>$t,GET_ORDER_SUMMARY:()=>St,LatestOrdersWidgetComponent:()=>u,LatestOrdersWidgetModule:()=>_,OrderChartWidgetComponent:()=>f,OrderSummaryWidgetComponent:()=>v,OrderSummaryWidgetModule:()=>C,TestWidgetComponent:()=>D,TestWidgetModule:()=>O,WelcomeWidgetComponent:()=>I,WelcomeWidgetModule:()=>$,dashboardRoutes:()=>x});var s=o(1139),X=o(412),l=o(2950),Y=o(8945),t=o(5220),y=o(2769),c=o(1133),b=o(1179),z=o(3120),J=o(568),H=o(6515),Q=o(9430),K=o(4299),Z=o(5888),q=o(8288),F=o(1646),p=o(647);const tt=["portal"],et=["*"];function nt(a,n){1&a&&t.SdG(0)}function rt(a,n){}class g{ngAfterViewInit(){this.loadWidget()}loadWidget(){var n=this;return(0,q.A)(function*(){const e=n.widgetConfig.loadComponent(),r=e instanceof Promise?yield e:e;n.componentRef=n.portal.createComponent(r),n.componentRef.changeDetectorRef.detectChanges()})()}ngOnDestroy(){this.componentRef&&this.componentRef.destroy()}static#t=this.\u0275fac=function(e){return new(e||g)};static#e=this.\u0275cmp=t.VBU({type:g,selectors:[["vdr-dashboard-widget"]],viewQuery:function(e,r){if(1&e&&t.GBs(tt,5,t.c1b),2&e){let i;t.mGM(i=t.lsd())&&(r.portal=i.first)}},inputs:{widgetConfig:"widgetConfig"},ngContentSelectors:et,decls:5,vars:3,consts:[["portal",""],[3,"title"],["vdrCardControls",""]],template:function(e,r){if(1&e&&(t.NAR(),t.j41(0,"vdr-card",1),t.nI1(1,"translate"),t.DNE(2,nt,1,0,"ng-template",2)(3,rt,0,0,"ng-template",null,0,t.C5r),t.k0s()),2&e){let i;t.Y8G("title",t.bMT(1,1,null!==(i=r.widgetConfig.title)&&void 0!==i?i:""))}},dependencies:[F.i,F.a,p.D9],styles:["[_nghost-%COMP%]{display:block}.card[_ngcontent-%COMP%]{margin-top:0;min-height:200px}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"],changeDetection:0})}const it=a=>({index:a}),at=a=>({width:a});function ot(a,n){if(1&a){const e=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){const i=t.eBV(e).$implicit,d=t.XpG();return t.Njj(d.addWidget(i.id))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&a){let e;const r=n.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,null!==(e=r.config.title)&&void 0!==e?e:r.id)," ")}}function st(a,n){if(1&a){const e=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){const i=t.eBV(e).$implicit,d=t.XpG(2).$implicit,m=t.XpG(2);return t.Njj(m.setWidgetWidth(d,i))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&a){const e=n.$implicit,r=t.XpG(2).$implicit;t.Y8G("disabled",e===r.width),t.R7$(),t.SpI(" ",t.i5U(2,2,"dashboard.widget-width",t.eq3(5,at,e))," ")}}function dt(a,n){if(1&a){const e=t.RV6();t.j41(0,"vdr-dashboard-widget",13)(1,"div",14)(2,"div",15),t.nrm(3,"clr-icon",16),t.k0s(),t.j41(4,"vdr-dropdown")(5,"button",17),t.nrm(6,"clr-icon",3),t.k0s(),t.j41(7,"vdr-dropdown-menu",4)(8,"h4",18),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.DNE(11,st,3,7,"button",19),t.nrm(12,"div",20),t.j41(13,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,d=t.XpG(2);return t.Njj(d.removeWidget(i))}),t.nrm(14,"clr-icon",21),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()}if(2&a){const e=t.XpG().$implicit,r=t.XpG(2);t.Y8G("widgetConfig",e.config),t.R7$(9),t.JRh(t.bMT(10,4,"dashboard.widget-resize")),t.R7$(2),t.Y8G("ngForOf",r.getSupportedWidths(e.config)),t.R7$(4),t.SpI(" ",t.bMT(16,6,"dashboard.remove-widget")," ")}}function ct(a,n){if(1&a&&(t.j41(0,"div",11),t.DNE(1,dt,17,8,"vdr-dashboard-widget",12),t.k0s()),2&a){const e=n.$implicit,r=t.XpG(2);t.Y8G("ngClass",r.getClassForWidth(e.width))("cdkDragData",e),t.R7$(),t.Y8G("vdrIfPermissions",e.config.requiresPermissions||null)}}function lt(a,n){if(1&a){const e=t.RV6();t.j41(0,"div",9),t.bIt("cdkDropListDropped",function(i){t.eBV(e);const d=t.XpG();return t.Njj(d.drop(i))}),t.DNE(1,ct,2,3,"div",10),t.k0s()}if(2&a){const e=n.$implicit,r=n.index,i=t.XpG();t.Y8G("cdkDropListData",t.eq3(3,it,r)),t.R7$(),t.Y8G("ngForOf",e)("ngForTrackBy",i.trackRowItem)}}class h{constructor(n,e,r,i){this.dashboardWidgetService=n,this.localStorageService=e,this.changedDetectorRef=r,this.dataService=i,this.deletionMarker="__delete__",this.setTitle=(0,s.kwp)()}ngOnInit(){this.availableWidgets$=this.dataService.client.userStatus().stream$.pipe((0,l.T)(({userStatus:n})=>n.permissions),(0,l.T)(n=>this.dashboardWidgetService.getAvailableWidgets(n)),(0,Y.M)(n=>this.widgetLayout=this.initLayout(n.map(e=>e.id)))),this.setTitle("breadcrumb.dashboard")}getClassForWidth(n){switch(n){case 3:return"clr-col-12 clr-col-sm-6 clr-col-lg-3";case 4:return"clr-col-12 clr-col-sm-6 clr-col-lg-4";case 6:return"clr-col-12 clr-col-lg-6";case 8:return"clr-col-12 clr-col-lg-8";case 12:return"clr-col-12";default:(0,X.assertNever)(n)}}getSupportedWidths(n){return n.supportedWidths||[3,4,6,8,12]}setWidgetWidth(n,e){n.width=e,this.recalculateLayout()}trackRow(n,e){return e.map(i=>`${i.id}:${i.width}`).join("|")}trackRowItem(n,e){return e.config}addWidget(n){const e=this.dashboardWidgetService.getWidgetById(n);if(e){const i={id:n,config:e,width:this.getSupportedWidths(e)[0]};let d;this.widgetLayout&&this.widgetLayout.length?d=this.widgetLayout[this.widgetLayout.length-1]:(d=[],this.widgetLayout?.push(d)),d.push(i),this.recalculateLayout()}}removeWidget(n){n.id=this.deletionMarker,this.recalculateLayout()}drop(n){const{currentIndex:e,previousIndex:r,previousContainer:i,container:d}=n;if((r!==e||i.data.index!==d.data.index)&&this.widgetLayout){const m=this.widgetLayout[i.data.index],j=this.widgetLayout[d.data.index];m.splice(r,1),j.splice(e,0,n.item.data),this.recalculateLayout()}}initLayout(n){const e=this.localStorageService.get("dashboardWidgetLayout");let r;return e&&(r=e.filter(i=>n.includes(i.id))),this.dashboardWidgetService.getWidgetLayout(r)}recalculateLayout(){if(this.widgetLayout){const e=this.widgetLayout.reduce((r,i)=>[...r,...i],[]).filter(r=>r.id!==this.deletionMarker).map(r=>({id:r.id,width:r.width}));this.widgetLayout=this.dashboardWidgetService.getWidgetLayout(e),this.localStorageService.set("dashboardWidgetLayout",e),setTimeout(()=>this.changedDetectorRef.markForCheck())}}static#t=this.\u0275fac=function(e){return new(e||h)(t.rXU(s.g_3),t.rXU(s.sji),t.rXU(t.gRc),t.rXU(s.uSP))};static#e=this.\u0275cmp=t.VBU({type:h,selectors:[["vdr-dashboard"]],decls:13,vars:8,consts:[[1,"widget-header","mb-1"],["vdrDropdownTrigger","",1,"btn","btn-secondary","btn-sm"],["shape","plus"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["cdkDropListGroup",""],["class","clr-row dashboard-row","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDropped",4,"ngFor","ngForOf","ngForTrackBy"],["vdrDropdownItem","",3,"click"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"clr-row","dashboard-row",3,"cdkDropListDropped","cdkDropListData"],["class","dashboard-item","cdkDrag","",3,"ngClass","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"dashboard-item",3,"ngClass","cdkDragData"],[3,"widgetConfig",4,"vdrIfPermissions"],[3,"widgetConfig"],[1,"flex"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],["vdrDropdownTrigger","",1,"icon-button"],[1,"dropdown-header"],["vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["role","separator",1,"dropdown-divider"],["shape","trash",1,"is-danger"],["vdrDropdownItem","",3,"click","disabled"]],template:function(e,r){1&e&&(t.j41(0,"vdr-page-block")(1,"div",0)(2,"vdr-dropdown")(3,"button",1),t.nrm(4,"clr-icon",2),t.EFF(5),t.nI1(6,"translate"),t.nrm(7,"clr-icon",3),t.k0s(),t.j41(8,"vdr-dropdown-menu",4),t.DNE(9,ot,3,3,"button",5),t.nI1(10,"async"),t.k0s()()(),t.j41(11,"div",6),t.DNE(12,lt,2,5,"div",7),t.k0s()()),2&e&&(t.R7$(5),t.SpI(" ",t.bMT(6,4,"dashboard.add-widget")," "),t.R7$(4),t.Y8G("ngForOf",t.bMT(10,6,r.availableWidgets$)),t.R7$(3),t.Y8G("ngForOf",r.widgetLayout)("ngForTrackBy",r.trackRow))},dependencies:[y.U4n,c.YU,c.Sq,b.O7,b.RK,b.T1,b.Fb,z.P,J.q,H.j,Q.M,K.p,Z.e,g,c.Jj,p.D9],styles:[".widget-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300);text-align:center}.placeholder[_ngcontent-%COMP%]   .version[_ngcontent-%COMP%]{font-size:3em;margin:24px;line-height:1em}.placeholder[_ngcontent-%COMP%]     .clr-i-outline{fill:var(--color-grey-200)}vdr-dashboard-widget[_ngcontent-%COMP%]{margin-bottom:24px}.drag-handle[_ngcontent-%COMP%]{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dashboard-row[_ngcontent-%COMP%]{padding:0;border-width:1;margin-bottom:6px;transition:padding .2s,margin .2s}.dashboard-row.cdk-drop-list-dragging[_ngcontent-%COMP%], .dashboard-row.cdk-drop-list-receiving[_ngcontent-%COMP%]{border:2px dashed var(--color-component-border-200);border-radius:var(--border-radius);padding:6px}.dashboard-row.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dashboard-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}var G=o(2703);const x=[{path:"",component:h,pathMatch:"full"}];var R=o(4500),w=o(9488),mt=o(3056),pt=o(7600),gt=o(4709),ht=o(3202),L=o(4646),E=o(7463);const ut=a=>["/orders/",a];function ft(a,n){if(1&a&&(t.j41(0,"a",6)(1,"span"),t.EFF(2),t.k0s(),t.nrm(3,"clr-icon",7),t.k0s()),2&a){const e=n.item;t.Y8G("routerLink",t.eq3(2,ut,e.id)),t.R7$(2),t.JRh(e.code)}}function vt(a,n){if(1&a&&t.nrm(0,"vdr-order-state-label",8),2&a){const e=n.item;t.Y8G("state",e.state)}}function yt(a,n){if(1&a&&t.nrm(0,"vdr-customer-label",9),2&a){const e=n.item;t.Y8G("customer",e.customer)}}function bt(a,n){if(1&a&&(t.EFF(0),t.nI1(1,"localeCurrency")),2&a){const e=n.item;t.SpI(" ",t.i5U(1,1,e.totalWithTax,e.currencyCode)," ")}}function _t(a,n){if(1&a&&(t.EFF(0),t.nI1(1,"timeAgo")),2&a){const e=n.item;t.SpI(" ",t.bMT(1,1,e.orderPlacedAt)," ")}}w.J1`
    query GetLatestOrders($options: OrderListOptions) {
        orders(options: $options) {
            items {
                id
                createdAt
                updatedAt
                type
                orderPlacedAt
                code
                state
                total
                totalWithTax
                currencyCode
                customer {
                    id
                    firstName
                    lastName
                }
            }
        }
    }
`;class u{constructor(n){this.dataService=n}ngOnInit(){this.latestOrders$=this.dataService.query(s.eWg,{options:{take:10,filter:{active:{eq:!1},state:{notIn:["Cancelled","Draft"]}},sort:{orderPlacedAt:s.xBQ.DESC}}}).refetchOnChannelChange().mapStream(n=>n.orders.items)}static#t=this.\u0275fac=function(e){return new(e||u)(t.rXU(s.uSP))};static#e=this.\u0275cmp=t.VBU({type:u,selectors:[["vdr-latest-orders-widget"]],decls:17,vars:20,consts:[["id","latest-orders-widget-list",3,"items"],["id","code",3,"heading"],["id","state",3,"heading","hiddenByDefault"],["id","customer",3,"heading","hiddenByDefault"],["id","total",3,"heading"],["id","placed-at",3,"heading"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"state"],[3,"customer"]],template:function(e,r){1&e&&(t.j41(0,"vdr-data-table-2",0),t.nI1(1,"async"),t.j41(2,"vdr-dt2-column",1),t.nI1(3,"translate"),t.DNE(4,ft,4,4,"ng-template"),t.k0s(),t.j41(5,"vdr-dt2-column",2),t.nI1(6,"translate"),t.DNE(7,vt,1,1,"ng-template"),t.k0s(),t.j41(8,"vdr-dt2-column",3),t.nI1(9,"translate"),t.DNE(10,yt,1,1,"ng-template"),t.k0s(),t.j41(11,"vdr-dt2-column",4),t.nI1(12,"translate"),t.DNE(13,bt,2,4,"ng-template"),t.k0s(),t.j41(14,"vdr-dt2-column",5),t.nI1(15,"translate"),t.DNE(16,_t,2,3,"ng-template"),t.k0s()()),2&e&&(t.Y8G("items",t.bMT(1,8,r.latestOrders$)),t.R7$(2),t.Y8G("heading",t.bMT(3,10,"common.code")),t.R7$(3),t.Y8G("heading",t.bMT(6,12,"order.state"))("hiddenByDefault",!0),t.R7$(3),t.Y8G("heading",t.bMT(9,14,"customer.customer"))("hiddenByDefault",!0),t.R7$(3),t.Y8G("heading",t.bMT(12,16,"order.total")),t.R7$(3),t.Y8G("heading",t.bMT(15,18,"order.placed-at")))},dependencies:[y.U4n,G.Wk,mt.E,pt.F,gt.I,ht.Y,c.Jj,p.D9,L.n,E.u],styles:["vdr-data-table[_ngcontent-%COMP%]     table{margin-top:0}vdr-order-state-label[_ngcontent-%COMP%]{display:inline-block;margin-top:2px}"],changeDetection:0})}class _{static#t=this.\u0275fac=function(e){return new(e||_)};static#e=this.\u0275mod=t.$C({type:_});static#n=this.\u0275inj=t.G2t({imports:[s.Ui,s.GgS]})}var Ct=o(990),A=o(4288),Tt=o(7288),M=o(7114),P=o(4498),Dt=o(784),Ot=o(2224);function It(a,n){if(1&a){const e=t.RV6();t.j41(0,"div",2)(1,"button",3),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.metricType$.next(i.MetricType.OrderTotal))}),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",4),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.metricType$.next(i.MetricType.OrderCount))}),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.metricType$.next(i.MetricType.AverageOrderValue))}),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.nrm(10,"div",5),t.j41(11,"button",3),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.refresh())}),t.nrm(12,"clr-icon",6),t.k0s()()}if(2&a){const e=n.ngIf,r=t.XpG();t.R7$(),t.AVh("active",e===r.MetricType.OrderTotal),t.R7$(),t.SpI(" ",t.bMT(3,9,"dashboard.metric-order-total-value")," "),t.R7$(2),t.AVh("active",e===r.MetricType.OrderCount),t.R7$(),t.SpI(" ",t.bMT(6,11,"dashboard.metric-number-of-orders")," "),t.R7$(2),t.AVh("active",e===r.MetricType.AverageOrderValue),t.R7$(),t.SpI(" ",t.bMT(9,13,"dashboard.metric-average-order-value")," ")}}const $t=w.J1`
    query GetOrderChartData($refresh: Boolean, $types: [MetricType!]!) {
        metricSummary(input: { interval: Daily, types: $types, refresh: $refresh }) {
            interval
            type
            entries {
                label
                value
            }
        }
    }
`;class f{constructor(n){this.dataService=n,this.refresh$=new Ct.B,this.metricType$=new A.t(s.vj3.OrderTotal),this.MetricType=s.vj3}ngOnInit(){const n=this.dataService.settings.getActiveChannel().refetchOnChannelChange().mapStream(i=>i.activeChannel.defaultCurrencyCode||void 0),e=this.dataService.client.uiState().mapStream(i=>i.uiState),r=this.metricType$.pipe((0,P.F)());this.metrics$=(0,Tt.z)(r,n,e).pipe((0,M.n)(([i,d,m])=>this.refresh$.pipe((0,Dt.Z)(!1),(0,M.n)(j=>this.dataService.query(s.IEA,{types:[i],refresh:j}).mapSingle(S=>S.metricSummary).pipe((0,l.T)(S=>{const Ft=i===s.vj3.OrderCount?"number":"currency",Gt=`${m.language}-${m.locale}`,xt={formatValueAs:Ft,currencyCode:d,locale:Gt};return S.find(W=>W.type===i)?.entries.map(W=>({...W,formatOptions:xt}))??[]}))))))}refresh(){this.refresh$.next(!0)}static#t=this.\u0275fac=function(e){return new(e||f)(t.rXU(s.uSP))};static#e=this.\u0275cmp=t.VBU({type:f,selectors:[["vdr-order-chart-widget"]],decls:4,vars:6,consts:[[3,"entries"],["class","flex",4,"ngIf"],[1,"flex"],[1,"button-small",3,"click"],[1,"ml-1","button-small",3,"click"],[1,"flex-spacer"],["shape","refresh"]],template:function(e,r){1&e&&(t.nrm(0,"vdr-chart",0),t.nI1(1,"async"),t.DNE(2,It,13,15,"div",1),t.nI1(3,"async")),2&e&&(t.Y8G("entries",t.bMT(1,2,r.metrics$)),t.R7$(2),t.Y8G("ngIf",t.bMT(3,4,r.metricType$)))},dependencies:[y.U4n,c.bT,Ot.Q,c.Jj,p.D9],styles:[".button-small.active[_ngcontent-%COMP%]{background-color:var(--color-primary-200);color:var(--color-primary-900)}"],changeDetection:0})}var Rt=o(8210),V=o.n(Rt),B=o(8874),wt=o(1470);function Mt(a,n){if(1&a){const e=t.RV6();t.j41(0,"div",7)(1,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.selection$.next({timeframe:"day",date:i.today}))}),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.selection$.next({timeframe:"day",date:i.yesterday}))}),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"button",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.selection$.next({timeframe:"week"}))}),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"button",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.selection$.next({timeframe:"month"}))}),t.EFF(11),t.nI1(12,"translate"),t.k0s()()}if(2&a){const e=n.ngIf,r=t.XpG();t.R7$(),t.AVh("active",e.date===r.today),t.R7$(),t.SpI(" ",t.bMT(3,12,"dashboard.today")," "),t.R7$(2),t.AVh("active",e.date===r.yesterday),t.R7$(),t.SpI(" ",t.bMT(6,14,"dashboard.yesterday")," "),t.R7$(2),t.AVh("active","week"===e.timeframe),t.R7$(),t.SpI(" ",t.bMT(9,16,"dashboard.thisWeek")," "),t.R7$(2),t.AVh("active","month"===e.timeframe),t.R7$(),t.SpI(" ",t.bMT(12,18,"dashboard.thisMonth")," ")}}function jt(a,n){if(1&a&&(t.j41(0,"div",10),t.EFF(1),t.nI1(2,"localeDate"),t.nI1(3,"localeDate"),t.k0s()),2&a){const e=n.ngIf;t.R7$(),t.Lme(" ",t.bMT(2,2,e.start)," - ",t.bMT(3,4,e.end)," ")}}const St=w.J1`
    query GetOrderSummary($start: DateTime!, $end: DateTime!) {
        orders(options: { filter: { orderPlacedAt: { between: { start: $start, end: $end } } } }) {
            totalItems
            items {
                id
                totalWithTax
                currencyCode
            }
        }
    }
`;class v{constructor(n){this.dataService=n,this.today=new Date,this.yesterday=new Date((new Date).setDate(this.today.getDate()-1)),this.selection$=new A.t({timeframe:"day",date:this.today})}ngOnInit(){this.dateRange$=this.selection$.pipe((0,P.F)(),(0,l.T)(e=>({start:V()(e.date).startOf(e.timeframe).toDate(),end:V()(e.date).endOf(e.timeframe).toDate()})),(0,B.t)(1));const n=this.dateRange$.pipe((0,M.n)(({start:e,end:r})=>this.dataService.query(s.mVK,{start:e.toISOString(),end:r.toISOString()}).refetchOnChannelChange().mapStream(i=>i.orders)),(0,B.t)(1));this.totalOrderCount$=n.pipe((0,l.T)(e=>e.totalItems)),this.totalOrderValue$=n.pipe((0,l.T)(e=>e.items.reduce((r,i)=>r+i.totalWithTax,0))),this.currencyCode$=this.dataService.settings.getActiveChannel().refetchOnChannelChange().mapStream(e=>e.activeChannel.defaultCurrencyCode||void 0)}static#t=this.\u0275fac=function(e){return new(e||v)(t.rXU(s.uSP))};static#e=this.\u0275cmp=t.VBU({type:v,selectors:[["vdr-order-summary-widget"]],decls:22,vars:23,consts:[[1,"stats"],[1,"stat"],[1,"stat-figure"],[1,"stat-label"],[1,"footer"],["class","flex",4,"ngIf"],["class","date-range",4,"ngIf"],[1,"flex"],[1,"button-small",3,"click"],[1,"ml-1","button-small",3,"click"],[1,"date-range"]],template:function(e,r){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",3),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"div",1)(9,"div",2),t.EFF(10),t.nI1(11,"async"),t.nI1(12,"async"),t.nI1(13,"localeCurrency"),t.k0s(),t.j41(14,"div",3),t.EFF(15),t.nI1(16,"translate"),t.k0s()()(),t.j41(17,"div",4),t.DNE(18,Mt,13,20,"div",5),t.nI1(19,"async"),t.DNE(20,jt,4,6,"div",6),t.nI1(21,"async"),t.k0s()),2&e&&(t.R7$(3),t.JRh(t.bMT(4,6,r.totalOrderCount$)),t.R7$(3),t.JRh(t.bMT(7,8,"dashboard.total-orders")),t.R7$(4),t.SpI(" ",t.i5U(13,14,t.bMT(11,10,r.totalOrderValue$),t.bMT(12,12,r.currencyCode$)||void 0)," "),t.R7$(5),t.JRh(t.bMT(16,17,"dashboard.total-order-value")),t.R7$(3),t.Y8G("ngIf",t.bMT(19,19,r.selection$)),t.R7$(2),t.Y8G("ngIf",t.bMT(21,21,r.dateRange$)))},dependencies:[c.bT,c.Jj,p.D9,wt.P,E.u],styles:[".stats[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.stat[_ngcontent-%COMP%]{text-align:center}.stat-figure[_ngcontent-%COMP%]{font-size:2rem;line-height:3rem}.stat-label[_ngcontent-%COMP%]{text-transform:uppercase}.date-range[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 3);font-size:var(--font-size-xs)}.footer[_ngcontent-%COMP%]{margin-top:24px;display:flex;flex-direction:column;justify-content:space-between}.button-small.active[_ngcontent-%COMP%]{background-color:var(--color-primary-200);color:var(--color-primary-900)}"],changeDetection:0})}class C{static#t=this.\u0275fac=function(e){return new(e||C)};static#e=this.\u0275mod=t.$C({type:C});static#n=this.\u0275inj=t.G2t({imports:[s.Ui]})}const U=[{id:"metrics",width:12},{id:"orderSummary",width:6},{id:"latestOrders",width:6}],N={metrics:{title:(0,R.x)("dashboard.metrics"),supportedWidths:[6,8,12],loadComponent:()=>f,requiresPermissions:[s.aXG.ReadOrder]},orderSummary:{title:(0,R.x)("dashboard.orders-summary"),loadComponent:()=>v,supportedWidths:[4,6,8,12],requiresPermissions:[s.aXG.ReadOrder]},latestOrders:{title:(0,R.x)("dashboard.latest-orders"),loadComponent:()=>u,supportedWidths:[6,8,12],requiresPermissions:[s.aXG.ReadOrder]}};class T{constructor(n){Object.entries(N).map(([e,r])=>{n.getWidgetById(e)||n.registerWidget(e,r)}),0===n.getDefaultLayout().length&&n.setDefaultLayout(U)}static#t=this.\u0275fac=function(e){return new(e||T)(t.KVO(s.g_3))};static#e=this.\u0275mod=t.$C({type:T});static#n=this.\u0275inj=t.G2t({imports:[s.GgS,G.iI.forChild(x)]})}class D{static#t=this.\u0275fac=function(e){return new(e||D)};static#e=this.\u0275cmp=t.VBU({type:D,selectors:[["vdr-test-widget"]],decls:2,vars:0,template:function(e,r){1&e&&(t.j41(0,"p"),t.EFF(1,"This is a test widget!"),t.k0s())},changeDetection:0})}class O{static#t=this.\u0275fac=function(e){return new(e||O)};static#e=this.\u0275mod=t.$C({type:O});static#n=this.\u0275inj=t.G2t({})}function Wt(a,n){if(1&a&&(t.j41(0,"p",4),t.EFF(1),t.k0s()),2&a){const e=t.XpG(2);t.R7$(),t.Lme(" ",e.hideVendureBranding?"":"Vendure"," ",e.hideVersion?"":"Admin UI v"+e.version," ")}}function kt(a,n){if(1&a&&(t.j41(0,"div")(1,"h4",3),t.EFF(2),t.nrm(3,"br"),t.j41(4,"small",4),t.EFF(5),t.nI1(6,"timeAgo"),t.k0s()(),t.DNE(7,Wt,2,2,"p",5),t.k0s()),2&a){const e=n.ngIf,r=t.XpG();t.R7$(2),t.Lme(" Welcome, ",e.firstName," ",e.lastName,""),t.R7$(3),t.SpI("Last login: ",t.bMT(6,4,e.user.lastLogin),""),t.R7$(2),t.Y8G("ngIf",!r.hideVendureBranding||!r.hideVersion)}}class I{constructor(n){this.dataService=n,this.version=s.cBU,this.brand=(0,s.WEc)().brand,this.hideVendureBranding=(0,s.WEc)().hideVendureBranding,this.hideVersion=(0,s.WEc)().hideVersion}ngOnInit(){this.administrator$=this.dataService.administrator.getActiveAdministrator().mapStream(n=>n.activeAdministrator||null)}static#t=this.\u0275fac=function(e){return new(e||I)(t.rXU(s.uSP))};static#e=this.\u0275cmp=t.VBU({type:I,selectors:[["vdr-welcome-widget"]],decls:4,vars:3,consts:[[4,"ngIf"],[1,"placeholder"],["shape","line-chart","size","128"],[1,""],[1,"p5"],["class","p5",4,"ngIf"]],template:function(e,r){1&e&&(t.DNE(0,kt,8,6,"div",0),t.nI1(1,"async"),t.j41(2,"div",1),t.nrm(3,"clr-icon",2),t.k0s()),2&e&&t.Y8G("ngIf",t.bMT(1,1,r.administrator$))},dependencies:[y.U4n,c.bT,c.Jj,L.n],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between}.placeholder[_ngcontent-%COMP%]{color:var(--color-grey-200)}"],changeDetection:0})}class ${static#t=this.\u0275fac=function(e){return new(e||$)};static#e=this.\u0275mod=t.$C({type:$});static#n=this.\u0275inj=t.G2t({imports:[s.Ui]})}}}]);
//# sourceMappingURL=668.8db9b709eec8b32f.js.map