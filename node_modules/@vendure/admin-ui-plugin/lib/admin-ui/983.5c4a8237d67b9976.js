"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[983],{3983:(fn,me,a)=>{a.r(me),a.d(me,{AddCustomerToGroupDialogComponent:()=>D,AddressCardComponent:()=>$,AddressDetailDialogComponent:()=>R,CUSTOMER_DETAIL_QUERY:()=>Ds,CUSTOMER_GROUP_DETAIL_QUERY:()=>ks,CUSTOMER_LIST_QUERY:()=>gn,CustomerDetailComponent:()=>j,CustomerGroupDetailComponent:()=>A,CustomerGroupDetailDialogComponent:()=>Z,CustomerGroupListComponent:()=>P,CustomerGroupMemberListComponent:()=>I,CustomerHistoryComponent:()=>N,CustomerHistoryEntryHostComponent:()=>k,CustomerListComponent:()=>x,CustomerModule:()=>y,CustomerStatusLabelComponent:()=>T,GET_CUSTOMER_GROUP_LIST:()=>nn,SelectCustomerGroupDialogComponent:()=>S,createRoutes:()=>ke,customerBreadcrumb:()=>hn,deleteCustomerGroupsBulkAction:()=>Re,deleteCustomersBulkAction:()=>Me,removeCustomerGroupMembersBulkAction:()=>Se});var F=a(4288),C=a(7114),p=a(2950),e=a(5220),m=a(1139),Y=a(1376),B=a(2559),c=a(4725),q=a(990),O=a(7288),U=a(784),ee=a(4498),Ne=a(1636),je=a(8945),ce=a(6893),b=a(2703),v=a(2769),te=a(5916),V=a(4709),L=a(3202),se=a(4764),u=a(1133),X=a(7482),h=a(647);function Ae(s,n){1&s&&(e.qex(0),e.nrm(1,"clr-icon",1),e.EFF(2),e.nI1(3,"translate"),e.bVm()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.verified")," "))}function Pe(s,n){1&s&&(e.qex(0),e.nrm(1,"clr-icon",2),e.EFF(2),e.nI1(3,"translate"),e.bVm()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.registered")," "))}function xe(s,n){if(1&s&&(e.j41(0,"vdr-chip"),e.DNE(1,Ae,4,3,"ng-container",0)(2,Pe,4,3,"ng-container",0),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",null==t.customer.user?null:t.customer.user.verified),e.R7$(),e.Y8G("ngIf",!(null!=t.customer.user&&t.customer.user.verified))}}function Ye(s,n){1&s&&(e.j41(0,"vdr-chip"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"customer.guest")))}class T{static#e=this.\u0275fac=function(t){return new(t||T)};static#t=this.\u0275cmp=e.VBU({type:T,selectors:[["vdr-customer-status-label"]],inputs:{customer:"customer"},decls:2,vars:2,consts:[[4,"ngIf"],["shape","check-circle",1,"verified-user-icon"],["shape","check-circle",1,"registered-user-icon"]],template:function(t,o){1&t&&e.DNE(0,xe,3,2,"vdr-chip",0)(1,Ye,3,3,"vdr-chip",0),2&t&&(e.Y8G("ngIf",null==o.customer.user?null:o.customer.user.id),e.R7$(),e.Y8G("ngIf",!(null!=o.customer.user&&o.customer.user.id)))},dependencies:[v.U4n,u.bT,X.w,h.D9],styles:[".registered-user-icon[_ngcontent-%COMP%]{color:var(--color-grey-300)}.verified-user-icon[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0})}var H=a(1470);const Be=s=>["/customer/customers",s];function Oe(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.id," ")}}function Ue(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.createdAt,"short")," ")}}function Ve(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.createdAt,"short")," ")}}function Le(s,n){if(1&s&&(e.j41(0,"a",9)(1,"span"),e.EFF(2),e.k0s(),e.nrm(3,"clr-icon",10),e.k0s()),2&s){const t=n.item;e.Y8G("routerLink",e.eq3(4,Be,t.id)),e.R7$(2),e.E5c(" ",t.title," ",t.firstName," ",t.lastName," ")}}function Xe(s,n){if(1&s&&e.nrm(0,"vdr-customer-status-label",11),2&s){const t=n.item;e.Y8G("customer",t)}}function He(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.emailAddress," ")}}class I{constructor(n,t){this.router=n,this.dataService=t,this.selectedMemberIds=[],this.selectionChange=new e.bkB,this.fetchParamsChange=new e.bkB,this.filterTermControl=new c.MJ(""),this.selectionManager=new m.YlH({multiSelect:!0,itemsAreEqual:(o,r)=>o.id===r.id,additiveMode:!0}),this.refresh$=new F.t(!0),this.destroy$=new q.B}ngOnInit(){this.membersCurrentPage$=this.route.paramMap.pipe((0,p.T)(t=>t.get("membersPage")),(0,p.T)(t=>t?+t:1),(0,U.Z)(1),(0,ee.F)()),this.membersItemsPerPage$=this.route.paramMap.pipe((0,p.T)(t=>t.get("membersPerPage")),(0,p.T)(t=>t?+t:10),(0,U.Z)(10),(0,ee.F)());const n=this.filterTermControl.valueChanges.pipe((0,Ne.B)(250),(0,je.M)(()=>this.setContentsPageNumber(1)),(0,U.Z)(""));(0,O.z)(this.membersCurrentPage$,this.membersItemsPerPage$,n,this.refresh$).pipe((0,ce.Q)(this.destroy$)).subscribe(([t,o,r])=>{const i=o,d=(t-1)*o;this.fetchParamsChange.emit({filterTerm:r??"",skip:d,take:i})}),this.selectionManager.setCurrentItems(this.members?.filter(t=>this.selectedMemberIds.includes(t.id))??[]),this.selectionManager.selectionChanges$.pipe((0,ce.Q)(this.destroy$)).subscribe(t=>{this.selectionChange.emit(t.map(o=>o.id))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(n){this.setParam("membersPage",n)}setContentsItemsPerPage(n){this.setParam("membersPerPage",n)}refresh(){this.refresh$.next(!0)}setParam(n,t){this.router.navigate(["./",{...this.route.snapshot.params,[n]:t}],{relativeTo:this.route,queryParamsHandling:"merge"})}static#e=this.\u0275fac=function(t){return new(t||I)(e.rXU(b.Ix),e.rXU(m.uSP))};static#t=this.\u0275cmp=e.VBU({type:I,selectors:[["vdr-customer-group-member-list"]],inputs:{locationId:"locationId",members:"members",totalItems:"totalItems",route:"route",selectedMemberIds:"selectedMemberIds",activeGroup:"activeGroup"},outputs:{selectionChange:"selectionChange",fetchParamsChange:"fetchParamsChange"},decls:24,vars:39,consts:[[3,"pageChange","itemsPerPageChange","id","items","itemsPerPage","totalItems","currentPage"],[3,"locationId","hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","updated-at",3,"heading","hiddenByDefault"],["id","name",3,"heading","optional"],["id","status",3,"heading","hiddenByDefault"],["id","email-address",3,"heading"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer"]],template:function(t,o){1&t&&(e.j41(0,"vdr-data-table-2",0),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("pageChange",function(i){return o.setContentsPageNumber(i)})("itemsPerPageChange",function(i){return o.setContentsItemsPerPage(i)}),e.nrm(3,"vdr-bulk-action-menu",1)(4,"vdr-dt2-search",2),e.nI1(5,"translate"),e.j41(6,"vdr-dt2-column",3),e.nI1(7,"translate"),e.DNE(8,Oe,1,1,"ng-template"),e.k0s(),e.j41(9,"vdr-dt2-column",4),e.nI1(10,"translate"),e.DNE(11,Ue,2,4,"ng-template"),e.k0s(),e.j41(12,"vdr-dt2-column",5),e.nI1(13,"translate"),e.DNE(14,Ve,2,4,"ng-template"),e.k0s(),e.j41(15,"vdr-dt2-column",6),e.nI1(16,"translate"),e.DNE(17,Le,4,6,"ng-template"),e.k0s(),e.j41(18,"vdr-dt2-column",7),e.nI1(19,"translate"),e.DNE(20,Xe,1,1,"ng-template"),e.k0s(),e.j41(21,"vdr-dt2-column",8),e.nI1(22,"translate"),e.DNE(23,He,1,1,"ng-template"),e.k0s()()),2&t&&(e.Y8G("id",o.locationId)("items",o.members)("itemsPerPage",e.bMT(1,21,o.membersItemsPerPage$))("totalItems",o.totalItems)("currentPage",e.bMT(2,23,o.membersCurrentPage$)),e.R7$(3),e.Y8G("locationId",o.locationId)("hostComponent",o)("selectionManager",o.selectionManager),e.R7$(),e.Y8G("searchTermControl",o.filterTermControl)("searchTermPlaceholder",e.bMT(5,25,"customer.search-customers-by-email")),e.R7$(2),e.Y8G("heading",e.bMT(7,27,"common.id"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(10,29,"common.created-at"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(13,31,"common.updated-at"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(16,33,"customer.name"))("optional",!1),e.R7$(3),e.Y8G("heading",e.bMT(19,35,"common.status"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(22,37,"customer.email-address")))},dependencies:[v.U4n,b.Wk,te.T,V.I,L.Y,se.E,T,u.Jj,h.D9,H.P],changeDetection:0})}const we=s=>({groupName:s}),Je=s=>({count:s});function We(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"translate")),2&s){const t=e.XpG();e.SpI(" ",e.i5U(1,1,"customer.add-customers-to-group-with-name",e.eq3(4,we,t.group.name)),"\n")}}function Qe(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",3),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.cancel())}),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"button",4),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.add())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,3,"common.cancel")),e.R7$(2),e.Y8G("disabled",!t.selectedCustomerIds.length),e.R7$(),e.SpI(" ",e.i5U(5,5,"customer.add-customers-to-group-with-count",e.eq3(8,Je,t.selectedCustomerIds.length))," ")}}class D{constructor(n){this.dataService=n,this.selectedCustomerIds=[],this.fetchGroupMembers$=new F.t({skip:0,take:10,filterTerm:""})}ngOnInit(){const n=this.fetchGroupMembers$.pipe((0,C.n)(({skip:t,take:o,filterTerm:r})=>this.dataService.customer.getCustomerList(o,t,r).mapStream(i=>i.customers)));this.customers$=n.pipe((0,p.T)(t=>t.items)),this.customersTotal$=n.pipe((0,p.T)(t=>t.totalItems))}cancel(){this.resolveWith()}add(){this.resolveWith(this.selectedCustomerIds)}static#e=this.\u0275fac=function(t){return new(t||D)(e.rXU(m.uSP))};static#t=this.\u0275cmp=e.VBU({type:D,selectors:[["vdr-add-customer-to-group-dialog"]],decls:5,vars:8,consts:[["vdrDialogTitle",""],["locationId","customer-group-members-picker-list",3,"fetchParamsChange","selectionChange","members","totalItems","route","selectedMemberIds"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,o){1&t&&(e.DNE(0,We,2,6,"ng-template",0),e.j41(1,"vdr-customer-group-member-list",1),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("fetchParamsChange",function(i){return o.fetchGroupMembers$.next(i)})("selectionChange",function(i){return o.selectedCustomerIds=i}),e.k0s(),e.DNE(4,Qe,6,10,"ng-template",2)),2&t&&(e.R7$(),e.Y8G("members",e.bMT(2,4,o.customers$))("totalItems",e.bMT(3,6,o.customersTotal$))("route",o.route)("selectedMemberIds",o.selectedCustomerIds))},dependencies:[Y.b,B.M,I,u.Jj,h.D9],changeDetection:0})}var le=a(5504),de=a(5821),ze=a(6928);function Ze(s,n){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&s){const t=n.ngIf;e.R7$(),e.SpI("",t,",")}}function Ke(s,n){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&s){const t=n.ngIf;e.R7$(),e.SpI(" ",t,"")}}function qe(s,n){if(1&s&&e.DNE(0,Ze,2,1,"span",3)(1,Ke,2,1,"span",3),2&s){let t,o;const r=e.XpG();e.Y8G("ngIf",null==(t=r.addressForm.get("streetLine1"))?null:t.value),e.R7$(),e.Y8G("ngIf",null==(o=r.addressForm.get("countryCode"))?null:o.value)}}function et(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",4),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.cancel())}),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"button",5),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.save())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,3,"common.cancel")),e.R7$(2),e.Y8G("disabled",!t.addressForm.valid||!t.addressForm.touched),e.R7$(),e.SpI(" ",e.bMT(5,5,"common.update")," ")}}class R{constructor(n){this.changeDetector=n,this.availableCountries=[]}ngOnInit(){this.addressForm.valueChanges.subscribe(()=>this.changeDetector.markForCheck())}cancel(){this.resolveWith()}save(){this.resolveWith(this.addressForm)}static#e=this.\u0275fac=function(t){return new(t||R)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:R,selectors:[["vdr-address-detail-dialog"]],decls:3,vars:3,consts:[["vdrDialogTitle",""],[3,"formGroup","availableCountries","customFields"],["vdrDialogButtons",""],[4,"ngIf"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,o){1&t&&(e.DNE(0,qe,2,2,"ng-template",0),e.nrm(1,"vdr-address-form",1),e.DNE(2,et,6,7,"ng-template",2)),2&t&&(e.R7$(),e.Y8G("formGroup",o.addressForm)("availableCountries",o.availableCountries)("customFields",o.customFields))},dependencies:[u.bT,c.cb,c.j4,Y.b,B.M,ze.O,h.D9],styles:["clr-input-container[_ngcontent-%COMP%]{margin-bottom:12px}"],changeDetection:0})}var ue=a(3120),pe=a(568),_e=a(6515),ge=a(9430),tt=a(3512),st=a(2164);function nt(s,n){if(1&s&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&s){const t=e.XpG().ngIf;e.R7$(),e.SpI("",t.streetLine1,",")}}function ot(s,n){1&s&&(e.j41(0,"vdr-chip",15),e.nrm(1,"clr-icon",16),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.default-shipping-address")," "))}function rt(s,n){1&s&&(e.j41(0,"vdr-chip",15),e.nrm(1,"clr-icon",17),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.default-billing-address")," "))}function it(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",18),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.editAddress())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"vdr-dropdown")(5,"button",19),e.EFF(6),e.nI1(7,"translate"),e.nrm(8,"clr-icon",20),e.k0s(),e.j41(9,"vdr-dropdown-menu")(10,"button",21),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.setAsDefaultShippingAddress())}),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"button",21),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.setAsDefaultBillingAddress())}),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.nrm(16,"div",22),e.j41(17,"button",23),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.delete())}),e.nrm(18,"clr-icon",24),e.EFF(19),e.nI1(20,"translate"),e.k0s()()(),e.bVm()}if(2&s){const t=e.XpG(2);e.R7$(2),e.SpI(" ",e.bMT(3,7,"common.edit")," "),e.R7$(4),e.SpI(" ",e.bMT(7,9,"common.more")," "),e.R7$(4),e.Y8G("disabled",t.isDefaultShipping),e.R7$(),e.SpI(" ",e.bMT(12,11,"customer.set-as-default-shipping-address")," "),e.R7$(2),e.Y8G("disabled",t.isDefaultBilling),e.R7$(),e.SpI(" ",e.bMT(15,13,"customer.set-as-default-billing-address")," "),e.R7$(5),e.SpI(" ",e.bMT(20,15,"common.delete")," ")}}function at(s,n){if(1&s&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3),e.DNE(3,nt,2,1,"span",4),e.EFF(4),e.k0s(),e.j41(5,"div",5),e.DNE(6,ot,4,3,"vdr-chip",6)(7,rt,4,3,"vdr-chip",6),e.k0s()(),e.j41(8,"div",7)(9,"div",8),e.nrm(10,"vdr-formatted-address",9),e.k0s()(),e.j41(11,"div",10)(12,"div",11),e.nrm(13,"vdr-entity-info",12),e.DNE(14,it,21,17,"ng-container",13),e.k0s()()()),2&s){const t=n.ngIf,o=e.XpG();e.R7$(3),e.Y8G("ngIf",t.streetLine1),e.R7$(),e.SpI(" ",t.countryCode," "),e.R7$(2),e.Y8G("ngIf",o.isDefaultShipping),e.R7$(),e.Y8G("ngIf",o.isDefaultBilling),e.R7$(3),e.Y8G("address",t),e.R7$(3),e.Y8G("entity",t),e.R7$(),e.Y8G("ngIf",o.editable)}}class ${constructor(n,t){this.modalService=n,this.changeDetector=t,this.availableCountries=[],this.editable=!0,this.setAsDefaultShipping=new e.bkB,this.setAsDefaultBilling=new e.bkB,this.deleteAddress=new e.bkB,this.dataDependenciesPopulated=new F.t(!1)}ngOnInit(){this.addressForm.get("streetLine1").value||this.dataDependenciesPopulated.pipe((0,le.p)(t=>t),(0,de.s)(1)).subscribe(()=>{this.editAddress()})}ngOnChanges(n){null!=this.customFields&&null!=this.availableCountries&&this.dataDependenciesPopulated.next(!0)}getCountryName(n){if(!this.availableCountries)return"";const t=this.availableCountries.find(o=>o.code===n);return t?t.name:""}setAsDefaultBillingAddress(){this.setAsDefaultBilling.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}setAsDefaultShippingAddress(){this.setAsDefaultShipping.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}delete(){this.deleteAddress.emit(this.addressForm.value.id),this.addressForm.markAsDirty()}editAddress(){this.modalService.fromComponent(R,{locals:{addressForm:this.addressForm,customFields:this.customFields,availableCountries:this.availableCountries},size:"md",closable:!0}).subscribe(()=>{this.changeDetector.markForCheck()})}static#e=this.\u0275fac=function(t){return new(t||$)(e.rXU(m.Bg8),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:$,selectors:[["vdr-address-card"]],inputs:{addressForm:"addressForm",customFields:"customFields",availableCountries:"availableCountries",isDefaultBilling:"isDefaultBilling",isDefaultShipping:"isDefaultShipping",editable:"editable"},outputs:{setAsDefaultShipping:"setAsDefaultShipping",setAsDefaultBilling:"setAsDefaultBilling",deleteAddress:"deleteAddress"},features:[e.OA$],decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"address-title"],["class","street-line",4,"ngIf"],[1,"default-controls"],["class","is-default p8",4,"ngIf"],[1,"card-block"],[1,"card-text"],[3,"address"],[1,"card-footer"],[1,"address-actions"],[3,"entity"],[4,"ngIf"],[1,"street-line"],[1,"is-default","p8"],["shape","truck"],["shape","credit-card"],[1,"button-small",3,"click"],["type","button","vdrDropdownTrigger","",1,"button-small"],["shape","ellipsis-vertical","size","12"],["vdrDropdownItem","",3,"click","disabled"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,o){1&t&&e.DNE(0,at,15,7,"div",0),2&t&&e.Y8G("ngIf",o.addressForm.value)},dependencies:[v.U4n,u.bT,X.w,ue.P,pe.q,_e.j,ge.M,tt.W,st.n,h.D9],styles:["[_nghost-%COMP%]{display:block;max-width:360px}clr-input-container[_ngcontent-%COMP%]{margin-bottom:12px}.defaul-controls[_ngcontent-%COMP%]{display:flex}.is-default[_ngcontent-%COMP%]{margin:0;color:var(--color-success-500)}.address-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-unit)}.address-actions[_ngcontent-%COMP%]   vdr-entity-info[_ngcontent-%COMP%]{margin-top:1px}"],changeDetection:0})}var l=a(4500),mt=a(412),w=a(9488),ct=a(7728),he=a(4632),E=a(3867),lt=a(8874),dt=a(1138);const{isArray:ut}=Array;var _t=a(4641),fe=a(1258);function gt(...s){const n=(0,fe.lI)(s),t=(0,fe.R0)(s,1/0);return s=function pt(s){return 1===s.length&&ut(s[0])?s[0]:s}(s),(0,dt.N)((o,r)=>{(0,_t.U)(t)((0,he.H)([o,...s],n)).subscribe(r)})}var ht=a(1860),ft=a(6366),ne=a(2786);const Ct=s=>({count:s});function bt(s,n){1&s&&(e.EFF(0),e.nI1(1,"translate")),2&s&&e.SpI(" ",e.bMT(1,1,"customer.add-customer-to-group"),"\n")}function vt(s,n){if(1&s){const t=e.RV6();e.j41(0,"span",5),e.bIt("click",function(){const r=e.eBV(t),i=r.item,d=r.clear;return e.Njj(d(i))}),e.EFF(1," \xd7 "),e.k0s(),e.j41(2,"vdr-chip",6),e.EFF(3),e.k0s()}if(2&s){const t=n.item;e.R7$(2),e.Y8G("colorFrom",t.id),e.R7$(),e.JRh(t.name)}}function Tt(s,n){if(1&s&&(e.j41(0,"vdr-chip",6),e.EFF(1),e.k0s()),2&s){const t=n.item;e.Y8G("colorFrom",t.id),e.R7$(),e.JRh(t.name)}}function It(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.cancel())}),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"button",8),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.add())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,3,"common.cancel")),e.R7$(2),e.Y8G("disabled",!t.selectedGroupIds.length),e.R7$(),e.SpI(" ",e.i5U(5,5,"customer.add-customer-to-groups-with-count",e.eq3(8,Ct,t.selectedGroupIds.length))," ")}}class S{constructor(n){this.dataService=n,this.selectedGroupIds=[]}ngOnInit(){this.groups$=this.dataService.customer.getCustomerGroupList().mapStream(n=>n.customerGroups.items)}cancel(){this.resolveWith()}add(){this.resolveWith(this.selectedGroupIds)}static#e=this.\u0275fac=function(t){return new(t||S)(e.rXU(m.uSP))};static#t=this.\u0275cmp=e.VBU({type:S,selectors:[["vdr-select-customer-group-dialog"]],decls:6,vars:8,consts:[["vdrDialogTitle",""],["appendTo","body","bindValue","id",3,"ngModelChange","items","addTag","multiple","ngModel","clearable","searchable"],["ng-label-tmp",""],["ng-option-tmp",""],["vdrDialogButtons",""],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[3,"colorFrom"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,o){1&t&&(e.DNE(0,bt,2,3,"ng-template",0),e.j41(1,"ng-select",1),e.nI1(2,"async"),e.mxI("ngModelChange",function(i){return e.DH7(o.selectedGroupIds,i)||(o.selectedGroupIds=i),i}),e.DNE(3,vt,4,2,"ng-template",2)(4,Tt,2,2,"ng-template",3),e.k0s(),e.DNE(5,It,6,10,"ng-template",4)),2&t&&(e.R7$(),e.Y8G("items",e.bMT(2,6,o.groups$))("addTag",!1)("multiple",!0),e.R50("ngModel",o.selectedGroupIds),e.Y8G("clearable",!0)("searchable",!1))},dependencies:[c.BC,c.vS,ne.vr,ne.Uq,ne.ZZ,X.w,Y.b,B.M,u.Jj,h.D9],changeDetection:0})}var f=a(8074),J=a(3766),oe=a(1548),W=a(4538),yt=a(7600),Ce=a(410),M=a(4299),Q=a(6292),re=a(3394),be=a(2910),ie=a(3987),z=a(5888),ve=a(1998),Te=a(1002),Ie=a(520),ye=a(1646),Gt=a(4128),Ge=a(1650),Ft=a(5584);const Dt=["portal"];class k{constructor(n){this.historyEntryComponentService=n,this.expandClick=new e.bkB}ngOnInit(){const n=this.historyEntryComponentService.getComponent(this.entry.type),t=this.portalRef.createComponent(n);t.instance.entry=this.entry,t.instance.customer=this.customer,this.instance=t.instance,this.componentRef=t}ngOnDestroy(){this.componentRef?.destroy()}static#e=this.\u0275fac=function(t){return new(t||k)(e.rXU(m.HMZ))};static#t=this.\u0275cmp=e.VBU({type:k,selectors:[["vdr-customer-history-entry-host"]],viewQuery:function(t,o){if(1&t&&e.GBs(Dt,7,e.c1b),2&t){let r;e.mGM(r=e.lsd())&&(o.portalRef=r.first)}},inputs:{entry:"entry",customer:"customer",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],decls:3,vars:6,consts:[["portal",""],[3,"expandClick","displayType","iconShape","createdAt","name","featured","collapsed"]],template:function(t,o){if(1&t){const r=e.RV6();e.j41(0,"vdr-timeline-entry",1),e.bIt("expandClick",function(){return e.eBV(r),e.Njj(o.expandClick.emit())}),e.nrm(1,"div",null,0),e.k0s()}2&t&&e.Y8G("displayType",o.instance.getDisplayType(o.entry))("iconShape",o.instance.getIconShape&&o.instance.getIconShape(o.entry))("createdAt",o.entry.createdAt)("name",o.instance.getName&&o.instance.getName(o.entry))("featured",o.instance.isFeatured(o.entry))("collapsed",!o.expanded&&!o.instance.isFeatured(o.entry))},dependencies:[Ge.r],encapsulation:2})}var ae=a(5505);const Fe=s=>({strategy:s}),De=s=>({groupName:s});function Rt(s,n){if(1&s){const t=e.RV6();e.j41(0,"vdr-timeline-entry",6)(1,"div",7)(2,"textarea",8),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG();return e.DH7(i.note,r)||(i.note=r),e.Njj(r)}),e.k0s(),e.j41(3,"button",9),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.addNoteToCustomer())}),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()}if(2&s){const t=e.XpG();e.Y8G("featured",!0)("isFirst",!0),e.R7$(2),e.R50("ngModel",t.note),e.R7$(),e.Y8G("disabled",!t.note),e.R7$(),e.SpI(" ",e.bMT(5,5,"order.add-note")," ")}}function $t(s,n){if(1&s){const t=e.RV6();e.j41(0,"vdr-customer-history-entry-host",11),e.bIt("expandClick",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.expanded=!r.expanded)}),e.k0s()}if(2&s){const t=e.XpG().$implicit,o=e.XpG();e.Y8G("customer",o.customer)("entry",t)("expanded",o.expanded)}}function Et(s,n){1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.history-using-native-auth-strategy")," "))}function St(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"translate")),2&s){const t=e.XpG(3).$implicit;e.SpI(" ",e.i5U(1,1,"customer.history-using-external-auth-strategy",e.eq3(4,Fe,t.data.strategy))," ")}}function Mt(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",16),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Et,3,3,"ng-container",17)(5,St,2,6,"ng-template",null,1,e.C5r),e.bVm()),2&s){const t=e.sdS(6),o=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,3,"customer.history-customer-registered")," "),e.R7$(2),e.Y8G("ngIf","native"===o.data.strategy)("ngIfElse",t)}}function kt(s,n){1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.history-using-native-auth-strategy")," "))}function Nt(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"translate")),2&s){const t=e.XpG(3).$implicit;e.SpI(" ",e.i5U(1,1,"customer.history-using-external-auth-strategy",e.eq3(4,Fe,t.data.strategy))," ")}}function jt(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",16),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,kt,3,3,"ng-container",17)(5,Nt,2,6,"ng-template",null,1,e.C5r),e.bVm()),2&s){const t=e.sdS(6),o=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,3,"customer.history-customer-verified")," "),e.R7$(2),e.Y8G("ngIf","native"===o.data.strategy)("ngIfElse",t)}}function At(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",18),e.EFF(2),e.nI1(3,"translate"),e.j41(4,"vdr-history-entry-detail"),e.nrm(5,"vdr-object-tree",19),e.k0s()(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,2,"customer.history-customer-detail-updated")," "),e.R7$(3),e.Y8G("value",t.data.input)}}function Pt(s,n){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,"customer.history-customer-added-to-group",e.eq3(4,De,t.data.groupName))," ")}}function xt(s,n){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,"customer.history-customer-removed-from-group",e.eq3(4,De,t.data.groupName))," ")}}function Yt(s,n){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",18)(4,"div",20),e.EFF(5),e.k0s()(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",e.bMT(2,2,"customer.history-customer-address-created")," "),e.R7$(4),e.JRh(t.data.address)}}function Bt(s,n){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",18)(4,"div",20),e.EFF(5),e.k0s(),e.j41(6,"vdr-history-entry-detail"),e.nrm(7,"vdr-object-tree",19),e.k0s()(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",e.bMT(2,3,"customer.history-customer-address-updated")," "),e.R7$(4),e.JRh(t.data.address),e.R7$(2),e.Y8G("value",t.data.input)}}function Ot(s,n){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",20),e.EFF(4),e.k0s(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",e.bMT(2,2,"customer.history-customer-address-deleted")," "),e.R7$(3),e.JRh(t.data.address)}}function Ut(s,n){1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.history-customer-password-updated")," "))}function Vt(s,n){1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.history-customer-password-reset-requested")," "))}function Lt(s,n){1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.history-customer-password-reset-verified")," "))}function Xt(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",18),e.EFF(2),e.nI1(3,"translate"),e.j41(4,"vdr-history-entry-detail")(5,"vdr-labeled-data",21),e.nI1(6,"translate"),e.EFF(7),e.k0s(),e.j41(8,"vdr-labeled-data",21),e.nI1(9,"translate"),e.EFF(10),e.k0s()()(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,5,"customer.history-customer-email-update-requested")," "),e.R7$(3),e.Y8G("label",e.bMT(6,7,"customer.old-email-address")),e.R7$(2),e.SpI("",t.data.oldEmailAddress," "),e.R7$(),e.Y8G("label",e.bMT(9,9,"customer.new-email-address")),e.R7$(2),e.SpI("",t.data.newEmailAddress," ")}}function Ht(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",18),e.EFF(2),e.nI1(3,"translate"),e.j41(4,"vdr-history-entry-detail")(5,"vdr-labeled-data",21),e.nI1(6,"translate"),e.EFF(7),e.k0s(),e.j41(8,"vdr-labeled-data",21),e.nI1(9,"translate"),e.EFF(10),e.k0s()()(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,5,"customer.history-customer-email-update-verified")," "),e.R7$(3),e.Y8G("label",e.bMT(6,7,"customer.old-email-address")),e.R7$(2),e.SpI("",t.data.oldEmailAddress," "),e.R7$(),e.Y8G("label",e.bMT(9,9,"customer.new-email-address")),e.R7$(2),e.SpI("",t.data.newEmailAddress," ")}}function wt(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",18)(2,"div",22),e.EFF(3),e.k0s(),e.nrm(4,"div",23),e.j41(5,"vdr-dropdown")(6,"button",24),e.nrm(7,"clr-icon",25),e.k0s(),e.j41(8,"vdr-dropdown-menu",26)(9,"button",27),e.nI1(10,"hasPermission"),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,i=e.XpG();return e.Njj(i.updateNote.emit(r))}),e.nrm(11,"clr-icon",28),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.nrm(14,"div",29),e.j41(15,"button",27),e.nI1(16,"hasPermission"),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,i=e.XpG();return e.Njj(i.deleteNote.emit(r))}),e.nrm(17,"clr-icon",30),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()(),e.bVm()}if(2&s){const t=e.XpG(2).$implicit;e.R7$(3),e.SpI(" ",t.data.note," "),e.R7$(6),e.Y8G("disabled",!e.bMT(10,5,"UpdateCustomer")),e.R7$(3),e.SpI(" ",e.bMT(13,7,"common.edit")," "),e.R7$(3),e.Y8G("disabled",!e.bMT(16,9,"UpdateCustomer")),e.R7$(3),e.SpI(" ",e.bMT(19,11,"common.delete")," ")}}function Jt(s,n){if(1&s&&(e.j41(0,"vdr-history-entry-detail"),e.nrm(1,"vdr-object-tree",19),e.k0s()),2&s){const t=e.XpG(3).$implicit;e.R7$(),e.Y8G("value",t.data)}}function Wt(s,n){if(1&s&&(e.qex(0),e.j41(1,"div",16),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Jt,2,1,"vdr-history-entry-detail",31),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,2,t.type)," "),e.R7$(2),e.Y8G("ngIf",t.data)}}function Qt(s,n){if(1&s&&(e.j41(0,"vdr-timeline-entry",12),e.qex(1,13),e.DNE(2,Mt,7,5,"ng-container",14)(3,jt,7,5,"ng-container",14)(4,At,6,4,"ng-container",14)(5,Pt,3,6,"ng-container",14)(6,xt,3,6,"ng-container",14)(7,Yt,6,4,"ng-container",14)(8,Bt,8,5,"ng-container",14)(9,Ot,5,4,"ng-container",14)(10,Ut,3,3,"ng-container",14)(11,Vt,3,3,"ng-container",14)(12,Lt,3,3,"ng-container",14)(13,Xt,11,11,"ng-container",14)(14,Ht,11,11,"ng-container",14)(15,wt,20,13,"ng-container",14)(16,Wt,5,4,"ng-container",15),e.bVm(),e.k0s()),2&s){const t=e.XpG().$implicit,o=e.XpG();e.Y8G("displayType",o.getDisplayType(t))("iconShape",o.getTimelineIcon(t))("createdAt",t.createdAt)("name",o.getName(t))("featured",o.isFeatured(t)),e.R7$(),e.Y8G("ngSwitch",t.type),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_REGISTERED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_VERIFIED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_DETAIL_UPDATED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_ADDED_TO_GROUP),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_REMOVED_FROM_GROUP),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_ADDRESS_CREATED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_ADDRESS_UPDATED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_ADDRESS_DELETED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_PASSWORD_UPDATED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_PASSWORD_RESET_REQUESTED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_PASSWORD_RESET_VERIFIED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_EMAIL_UPDATE_REQUESTED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_EMAIL_UPDATE_VERIFIED),e.R7$(),e.Y8G("ngSwitchCase",o.type.CUSTOMER_NOTE)}}function zt(s,n){if(1&s&&(e.qex(0),e.DNE(1,$t,1,3,"vdr-customer-history-entry-host",10)(2,Qt,17,20,"ng-template",null,0,e.C5r),e.bVm()),2&s){const t=n.$implicit,o=e.sdS(3),r=e.XpG();e.R7$(),e.Y8G("ngIf",r.hasCustomComponent(t.type))("ngIfElse",o)}}class N{constructor(n){this.historyEntryComponentService=n,this.addNote=new e.bkB,this.updateNote=new e.bkB,this.deleteNote=new e.bkB,this.note="",this.expanded=!1,this.type=m.Htj}hasCustomComponent(n){return!!this.historyEntryComponentService.getComponent(n)}getDisplayType(n){switch(n.type){case m.Htj.CUSTOMER_VERIFIED:case m.Htj.CUSTOMER_EMAIL_UPDATE_VERIFIED:case m.Htj.CUSTOMER_PASSWORD_RESET_VERIFIED:return"success";case m.Htj.CUSTOMER_REGISTERED:return"muted";case m.Htj.CUSTOMER_REMOVED_FROM_GROUP:return"error";default:return"default"}}getTimelineIcon(n){switch(n.type){case m.Htj.CUSTOMER_REGISTERED:return"user";case m.Htj.CUSTOMER_VERIFIED:return["assign-user","is-solid"];case m.Htj.CUSTOMER_NOTE:return"note";case m.Htj.CUSTOMER_ADDED_TO_GROUP:case m.Htj.CUSTOMER_REMOVED_FROM_GROUP:return"users"}}isFeatured(n){switch(n.type){case m.Htj.CUSTOMER_REGISTERED:case m.Htj.CUSTOMER_VERIFIED:return!0;default:return!1}}getName(n){const{administrator:t}=n;return t?`${t.firstName} ${t.lastName}`:`${this.customer.firstName} ${this.customer.lastName}`}addNoteToCustomer(){this.addNote.emit({note:this.note}),this.note=""}static#e=this.\u0275fac=function(t){return new(t||N)(e.rXU(m.HMZ))};static#t=this.\u0275cmp=e.VBU({type:N,selectors:[["vdr-customer-history"]],inputs:{customer:"customer",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:4,vars:3,consts:[["defaultComponents",""],["namedStrategy",""],[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured","isFirst",4,"vdrIfPermissions"],[4,"ngFor","ngForOf"],[3,"isLast"],["iconShape","note","displayType","muted",3,"featured","isFirst"],[1,"note-entry"],["name","note",1,"note",3,"ngModelChange","ngModel"],[1,"btn","btn-secondary",3,"click","disabled"],[3,"customer","entry","expanded","expandClick",4,"ngIf","ngIfElse"],[3,"expandClick","customer","entry","expanded"],[3,"displayType","iconShape","createdAt","name","featured"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"title"],[4,"ngIf","ngIfElse"],[1,"flex"],[3,"value"],[1,"address-string"],[3,"label"],[1,"note-text"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"button-small","ml-1"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"click","disabled"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[4,"ngIf"]],template:function(t,o){1&t&&(e.j41(0,"div",2),e.DNE(1,Rt,6,7,"vdr-timeline-entry",3)(2,zt,4,2,"ng-container",4),e.nrm(3,"vdr-timeline-entry",5),e.k0s()),2&t&&(e.R7$(),e.Y8G("vdrIfPermissions","UpdateCustomer"),e.R7$(),e.Y8G("ngForOf",o.history),e.R7$(),e.Y8G("isLast",!0))},dependencies:[v.U4n,u.Sq,u.bT,u.ux,u.e1,u.fG,c.me,c.BC,c.vS,W.V,ue.P,pe.q,_e.j,ge.M,Ce.B,Gt.T,M.p,Ge.r,Ft.f,k,h.D9,ae.E],styles:[".entry-list[_ngcontent-%COMP%]{margin:24px 12px 24px 24px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-inline-end:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-text-100);white-space:pre-wrap}.address-string[_ngcontent-%COMP%]{font-size:smaller;color:var(--color-text-200)}"],changeDetection:0})}var Zt=a(4646),Kt=a(7463);const qt=()=>["UpdateCustomer"],es=s=>["/orders",s];function ts(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.create())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("disabled",!(t.addressDefaultsUpdated||t.detailForm.valid&&t.detailForm.dirty)),e.R7$(),e.SpI(" ",e.bMT(2,2,"common.create")," ")}}function ss(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.save())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("disabled",!(t.addressDefaultsUpdated||t.detailForm.valid&&t.detailForm.dirty)),e.R7$(),e.SpI(" ",e.bMT(2,2,"common.update")," ")}}function ns(s,n){1&s&&e.DNE(0,ss,3,4,"button",23),2&s&&e.Y8G("vdrIfPermissions","UpdateCustomer")}function os(s,n){if(1&s&&(e.j41(0,"vdr-labeled-data",26),e.nI1(1,"translate"),e.j41(2,"time",27),e.EFF(3),e.nI1(4,"timeAgo"),e.k0s()()),2&s){const t=n.ngIf;e.Y8G("label",e.bMT(1,3,"customer.last-login")),e.R7$(2),e.Y8G("dateTime",t),e.R7$(),e.JRh(e.bMT(4,5,t))}}function rs(s,n){if(1&s&&(e.j41(0,"vdr-card"),e.nrm(1,"vdr-customer-status-label",24),e.DNE(2,os,5,7,"vdr-labeled-data",25),e.k0s()),2&s){const t=n.ngIf;e.R7$(),e.Y8G("customer",t),e.R7$(),e.Y8G("ngIf",null==t.user?null:t.user.lastLogin)}}function is(s,n){if(1&s){const t=e.RV6();e.j41(0,"vdr-chip",32),e.bIt("iconClick",function(){const r=e.eBV(t).$implicit,i=e.XpG(3);return e.Njj(i.removeFromGroup(r))}),e.EFF(1),e.k0s()}if(2&s){const t=n.$implicit;e.Y8G("colorFrom",t.id),e.R7$(),e.JRh(t.name)}}function as(s,n){if(1&s&&(e.j41(0,"div"),e.DNE(1,is,2,2,"vdr-chip",31),e.k0s()),2&s){const t=e.XpG().ngIf;e.R7$(),e.Y8G("ngForOf",t)}}function ms(s,n){1&s&&(e.j41(0,"span",33),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"customer.not-a-member-of-any-groups")," "))}function cs(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",34),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.addToGroup())}),e.nrm(1,"clr-icon",35),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.add-customer-to-group")," "))}function ls(s,n){if(1&s&&(e.j41(0,"vdr-card",28),e.nI1(1,"translate"),e.DNE(2,as,2,1,"div",29)(3,ms,3,3,"ng-template",null,1,e.C5r),e.j41(5,"div"),e.DNE(6,cs,4,3,"button",30),e.k0s()()),2&s){const t=n.ngIf,o=e.sdS(4);e.Y8G("title",e.bMT(1,4,"customer.customer-groups")),e.R7$(2),e.Y8G("ngIf",t.length)("ngIfElse",o),e.R7$(4),e.Y8G("vdrIfPermissions","UpdateCustomerGroup")}}function ds(s,n){if(1&s&&e.nrm(0,"vdr-page-entity-info",36),2&s){const t=n.ngIf;e.Y8G("entity",t)}}function us(s,n){1&s&&(e.j41(0,"vdr-form-field",37),e.nI1(1,"translate"),e.nrm(2,"input",38),e.k0s()),2&s&&e.Y8G("label",e.bMT(1,1,"customer.password"))}function ps(s,n){if(1&s&&(e.j41(0,"vdr-card",39),e.nI1(1,"translate"),e.nrm(2,"vdr-tabbed-custom-fields",40),e.k0s()),2&s){const t=e.XpG();e.Y8G("title",e.bMT(1,3,"common.custom-fields")),e.R7$(2),e.Y8G("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customer.customFields"))}}function _s(s,n){if(1&s){const t=e.RV6();e.j41(0,"vdr-address-card",55),e.nI1(1,"async"),e.nI1(2,"hasPermission"),e.bIt("setAsDefaultBilling",function(r){e.eBV(t);const i=e.XpG(2);return e.Njj(i.setDefaultBillingAddressId(r))})("setAsDefaultShipping",function(r){e.eBV(t);const i=e.XpG(2);return e.Njj(i.setDefaultShippingAddressId(r))})("deleteAddress",function(r){e.eBV(t);const i=e.XpG(2);return e.Njj(i.toggleDeleteAddress(r))}),e.k0s()}if(2&s){const t=n.$implicit,o=e.XpG(2);e.AVh("to-delete",o.addressesToDeleteIds.has(t.value.id)),e.Y8G("availableCountries",e.bMT(1,8,o.availableCountries$))("isDefaultBilling",o.defaultBillingAddressId===t.value.id)("isDefaultShipping",o.defaultShippingAddressId===t.value.id)("addressForm",t)("customFields",o.addressCustomFields)("editable",e.bMT(2,10,e.lJ4(12,qt))&&!o.addressesToDeleteIds.has(t.value.id))}}function gs(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",56),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.addAddress())}),e.nrm(1,"clr-icon",35),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"customer.create-new-address")," "))}function hs(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.id," ")}}function fs(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.createdAt,"short")," ")}}function Cs(s,n){if(1&s&&(e.j41(0,"a",57)(1,"span"),e.EFF(2),e.k0s(),e.nrm(3,"clr-icon",58),e.k0s()),2&s){const t=n.item;e.Y8G("routerLink",e.eq3(2,es,t.id)),e.R7$(2),e.JRh(t.code)}}function bs(s,n){if(1&s&&(e.j41(0,"vdr-chip"),e.EFF(1),e.k0s()),2&s){const t=n.item;e.R7$(),e.JRh(t.type)}}function vs(s,n){if(1&s&&e.nrm(0,"vdr-order-state-label",59),2&s){const t=n.item;e.Y8G("state",t.state)}}function Ts(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeCurrency")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.totalWithTax,t.currencyCode)," ")}}function Is(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"timeAgo")),2&s){const t=n.item;e.SpI(" ",e.bMT(1,1,t.updatedAt)," ")}}function ys(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.orderPlacedAt,"short")," ")}}function Gs(s,n){if(1&s&&e.nrm(0,"vdr-dt2-custom-field-column",60),2&s){const t=n.$implicit;e.Y8G("customField",t)}}function Fs(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"vdr-card",28),e.nI1(2,"translate"),e.j41(3,"div",8),e.DNE(4,_s,3,13,"vdr-address-card",41),e.k0s(),e.DNE(5,gs,4,3,"button",42),e.k0s(),e.j41(6,"vdr-card",43),e.nI1(7,"translate"),e.j41(8,"vdr-data-table-2",44),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"translate"),e.bIt("itemsPerPageChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.setOrderItemsPerPage(r))})("pageChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.setOrderCurrentPage(r))}),e.j41(12,"vdr-dt2-column",45),e.nI1(13,"translate"),e.DNE(14,hs,1,1,"ng-template"),e.k0s(),e.j41(15,"vdr-dt2-column",46),e.nI1(16,"translate"),e.DNE(17,fs,2,4,"ng-template"),e.k0s(),e.j41(18,"vdr-dt2-column",47),e.nI1(19,"translate"),e.DNE(20,Cs,4,4,"ng-template"),e.k0s(),e.j41(21,"vdr-dt2-column",48),e.nI1(22,"translate"),e.DNE(23,bs,2,1,"ng-template"),e.k0s(),e.j41(24,"vdr-dt2-column",49),e.nI1(25,"translate"),e.DNE(26,vs,1,1,"ng-template"),e.k0s(),e.j41(27,"vdr-dt2-column",50),e.nI1(28,"translate"),e.DNE(29,Ts,2,4,"ng-template"),e.k0s(),e.j41(30,"vdr-dt2-column",51),e.nI1(31,"translate"),e.DNE(32,Is,2,3,"ng-template"),e.k0s(),e.j41(33,"vdr-dt2-column",52),e.nI1(34,"translate"),e.DNE(35,ys,2,4,"ng-template"),e.k0s(),e.DNE(36,Gs,1,1,"vdr-dt2-custom-field-column",53),e.k0s()(),e.j41(37,"vdr-card",28),e.nI1(38,"translate"),e.j41(39,"vdr-customer-history",54),e.nI1(40,"async"),e.nI1(41,"async"),e.bIt("addNote",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.addNoteToCustomer(r))})("updateNote",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.updateNote(r))})("deleteNote",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteNote(r))}),e.k0s()(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("title",e.bMT(2,26,"customer.addresses")),e.R7$(3),e.Y8G("ngForOf",t.getAddressFormControls()),e.R7$(),e.Y8G("vdrIfPermissions","UpdateCustomer"),e.R7$(),e.Y8G("title",e.bMT(7,28,"customer.orders"))("paddingX",!1),e.R7$(2),e.Y8G("items",e.bMT(9,30,t.orders$))("itemsPerPage",t.ordersPerPage)("totalItems",e.bMT(10,32,t.ordersCount$))("currentPage",t.currentOrdersPage)("emptyStateLabel",e.bMT(11,34,"customer.no-orders-placed")),e.R7$(4),e.Y8G("heading",e.bMT(13,36,"common.id"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(16,38,"common.created-at"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(19,40,"common.code"))("optional",!1),e.R7$(3),e.Y8G("heading",e.bMT(22,42,"order.order-type"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(25,44,"order.state")),e.R7$(3),e.Y8G("heading",e.bMT(28,46,"order.total")),e.R7$(3),e.Y8G("heading",e.bMT(31,48,"common.updated-at")),e.R7$(3),e.Y8G("heading",e.bMT(34,50,"order.placed-at")),e.R7$(3),e.Y8G("ngForOf",t.customFields),e.R7$(),e.Y8G("title",e.bMT(38,52,"customer.customer-history")),e.R7$(2),e.Y8G("customer",e.bMT(40,54,t.entity$))("history",e.bMT(41,56,t.history$))}}const Ds=w.J1`
    query CustomerDetailQuery($id: ID!, $orderListOptions: OrderListOptions) {
        customer(id: $id) {
            ...Customer
            groups {
                id
                name
            }
            orders(options: $orderListOptions) {
                items {
                    id
                    code
                    type
                    state
                    total
                    totalWithTax
                    currencyCode
                    createdAt
                    updatedAt
                    orderPlacedAt
                }
                totalItems
            }
        }
    }
    ${m.oKx}
`;class j extends m.wi7{constructor(n,t,o,r,i){super(),this.changeDetector=n,this.formBuilder=t,this.dataService=o,this.modalService=r,this.notificationService=i,this.customFields=this.getCustomFieldConfig("Customer"),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.detailForm=this.formBuilder.group({customer:this.formBuilder.group({title:"",firstName:["",c.k0.required],lastName:["",c.k0.required],phoneNumber:"",emailAddress:["",[c.k0.required,c.k0.email]],password:"",customFields:this.formBuilder.group((0,m.HCD)(this.customFields))}),addresses:new c.Bm([])}),this.fetchHistory=new q.B,this.addressesToDeleteIds=new Set,this.addressDefaultsUpdated=!1,this.ordersPerPage=10,this.currentOrdersPage=1,this.orderListUpdates$=new q.B}ngOnInit(){this.init(),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(t=>t.countries.items).pipe((0,lt.t)(1));const n=this.entity$.pipe(gt(this.orderListUpdates$));this.orders$=n.pipe((0,p.T)(t=>t.orders.items)),this.ordersCount$=this.entity$.pipe((0,p.T)(t=>t.orders.totalItems)),this.history$=this.fetchHistory.pipe((0,U.Z)(null),(0,C.n)(()=>this.dataService.customer.getCustomerHistory(this.id,{sort:{createdAt:m.xBQ.DESC}}).mapStream(t=>t.customer?.history.items)))}ngOnDestroy(){this.destroy(),this.orderListUpdates$.complete()}getAddressFormControls(){return this.detailForm.get(["addresses"]).controls}setDefaultBillingAddressId(n){this.defaultBillingAddressId=n,this.addressDefaultsUpdated=!0}setDefaultShippingAddressId(n){this.defaultShippingAddressId=n,this.addressDefaultsUpdated=!0}toggleDeleteAddress(n){this.addressesToDeleteIds.has(n)?this.addressesToDeleteIds.delete(n):this.addressesToDeleteIds.add(n)}addAddress(){const n=this.detailForm.get("addresses"),t=this.formBuilder.group({fullName:"",company:"",streetLine1:["",c.k0.required],streetLine2:"",city:"",province:"",postalCode:"",countryCode:["",c.k0.required],phoneNumber:"",defaultShippingAddress:!1,defaultBillingAddress:!1,customFields:this.formBuilder.group(this.addressCustomFields.reduce((o,r)=>({...o,[r.name]:""}),{}))});n.push(t)}setOrderItemsPerPage(n){this.ordersPerPage=+n,this.fetchOrdersList()}setOrderCurrentPage(n){this.currentOrdersPage=+n,this.fetchOrdersList()}create(){const n=this.detailForm.get("customer");if(!n)return;const{title:t,emailAddress:o,firstName:r,lastName:i,phoneNumber:d,password:_}=n.value,g=n.get("customFields")?.value;if(!o||!r||!i)return;const G={title:t,emailAddress:o,firstName:r,lastName:i,phoneNumber:d,customFields:g};this.dataService.customer.createCustomer(G,_).subscribe(({createCustomer:K})=>{switch(K.__typename){case"Customer":this.notificationService.success((0,l.x)("common.notify-create-success"),{entity:"Customer"}),K.emailAddress&&!_&&this.notificationService.notify({message:(0,l.x)("customer.email-verification-sent"),translationVars:{emailAddress:o},type:"info",duration:1e4}),this.detailForm.markAsPristine(),this.addressDefaultsUpdated=!1,this.changeDetector.markForCheck(),this.router.navigate(["../",K.id],{relativeTo:this.route});break;case"EmailAddressConflictError":this.notificationService.error(K.message)}})}save(){this.entity$.pipe((0,de.s)(1),(0,ht.Z)(({id:n})=>{const t=[],o=this.detailForm.get("customer");if(o&&o.dirty){const i=o.value,d=o.get("customFields")?.value,_={id:n,title:i.title,emailAddress:i.emailAddress,firstName:i.firstName,lastName:i.lastName,phoneNumber:i.phoneNumber,customFields:d};t.push(this.dataService.customer.updateCustomer(_).pipe((0,p.T)(g=>g.updateCustomer)))}const r=this.detailForm.get("addresses");if(r&&r.dirty||this.addressDefaultsUpdated)for(const i of r.controls)if(i.dirty||this.addressDefaultsUpdated){const d=i.value,_={fullName:d.fullName,company:d.company,streetLine1:d.streetLine1,streetLine2:d.streetLine2,city:d.city,province:d.province,postalCode:d.postalCode,countryCode:d.countryCode,phoneNumber:d.phoneNumber,defaultShippingAddress:this.defaultShippingAddressId===d.id,defaultBillingAddress:this.defaultBillingAddressId===d.id,customFields:d.customFields};d.id?this.addressesToDeleteIds.has(d.id)?t.push(this.dataService.customer.deleteCustomerAddress(d.id).pipe((0,p.T)(g=>g.deleteCustomerAddress))):t.push(this.dataService.customer.updateCustomerAddress({..._,id:d.id}).pipe((0,p.T)(g=>g.updateCustomerAddress))):t.push(this.dataService.customer.createCustomerAddress(n,_).pipe((0,p.T)(g=>g.createCustomerAddress)))}return(0,ct.p)(t)})).subscribe(n=>{let t=!1;for(const o of n)switch(o.__typename){case"Customer":case"Address":case"Success":t||(this.notificationService.success((0,l.x)("common.notify-update-success"),{entity:"Customer"}),t=!0,this.detailForm.markAsPristine(),this.addressDefaultsUpdated=!1,this.changeDetector.markForCheck(),this.fetchHistory.next(),this.refreshCustomer().subscribe());break;case"EmailAddressConflictError":this.notificationService.error(o.message)}},n=>{this.notificationService.error((0,l.x)("common.notify-update-error"),{entity:"Customer"})})}addToGroup(){this.modalService.fromComponent(S,{size:"md"}).pipe((0,C.n)(n=>n?(0,he.H)(n):E.w),(0,ft.H)(n=>this.dataService.customer.addCustomersToGroup(n,[this.id]))).subscribe({next:n=>{this.notificationService.success((0,l.x)("customer.add-customers-to-group-success"),{customerCount:1,groupName:n.addCustomersToGroup.name})},complete:()=>{this.refreshCustomer().subscribe(),this.fetchHistory.next()}})}removeFromGroup(n){this.modalService.dialog({title:(0,l.x)("customer.confirm-remove-customer-from-group"),buttons:[{type:"secondary",label:(0,l.x)("common.cancel")},{type:"danger",label:(0,l.x)("common.delete"),returnValue:!0}]}).pipe((0,C.n)(t=>t?this.dataService.customer.removeCustomersFromGroup(n.id,[this.id]):E.w),(0,C.n)(()=>this.refreshCustomer())).subscribe(t=>{this.notificationService.success((0,l.x)("customer.remove-customers-from-group-success"),{customerCount:1,groupName:n.name}),this.fetchHistory.next()})}addNoteToCustomer({note:n}){this.dataService.customer.addNoteToCustomer(this.id,n).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,l.x)("common.notify-create-success"),{entity:"Note"})})}updateNote(n){this.modalService.fromComponent(m.MR8,{closable:!0,locals:{displayPrivacyControls:!1,note:n.data.note}}).pipe((0,C.n)(t=>t?this.dataService.customer.updateCustomerNote({noteId:n.id,note:t.note}):E.w)).subscribe(t=>{this.fetchHistory.next(),this.notificationService.success((0,l.x)("common.notify-update-success"),{entity:"Note"})})}deleteNote(n){return this.modalService.dialog({title:(0,l.x)("common.confirm-delete-note"),body:n.data.note,buttons:[{type:"secondary",label:(0,l.x)("common.cancel")},{type:"danger",label:(0,l.x)("common.delete"),returnValue:!0}]}).pipe((0,C.n)(t=>t?this.dataService.customer.deleteCustomerNote(n.id):E.w)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,l.x)("common.notify-delete-success"),{entity:"Note"})})}setFormValues(n){const t=this.detailForm.get("customer");if(t&&t.patchValue({title:n.title??null,firstName:n.firstName,lastName:n.lastName,phoneNumber:n.phoneNumber??null,emailAddress:n.emailAddress,password:"",customFields:{}}),n.addresses){const o=new c.Bm([]);for(const r of n.addresses){const{customFields:i,...d}=r,_=this.formBuilder.group({...d,countryCode:r.country.code,customFields:this.formBuilder.group(this.addressCustomFields.reduce((g,G)=>({...g,[G.name]:r.customFields[G.name]}),{}))});o.push(_),r.defaultShippingAddress&&(this.defaultShippingAddressId=r.id),r.defaultBillingAddress&&(this.defaultBillingAddressId=r.id)}this.detailForm.setControl("addresses",o)}this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customer","customFields"]),n),this.changeDetector.markForCheck()}fetchOrdersList(){this.dataService.query(m.L7M,{id:this.id,orderListOptions:{take:this.ordersPerPage,skip:(this.currentOrdersPage-1)*this.ordersPerPage,sort:{orderPlacedAt:m.xBQ.DESC}}}).single$.pipe((0,p.T)(n=>n.customer),(0,le.p)(mt.notNullOrUndefined)).subscribe(n=>this.orderListUpdates$.next(n))}refreshCustomer(){return this.dataService.query(m.L7M,{id:this.id,orderListOptions:{take:0}}).single$}static#e=this.\u0275fac=function(t){return new(t||j)(e.rXU(e.gRc),e.rXU(c.ok),e.rXU(m.uSP),e.rXU(m.Bg8),e.rXU(m.JEu))};static#t=this.\u0275cmp=e.VBU({type:j,selectors:[["vdr-customer-detail"]],features:[e.Vt3],decls:50,vars:53,consts:[["updateButton",""],["noGroups",""],["locationId","customer-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],[4,"ngIf"],[3,"title",4,"ngIf"],[3,"entity",4,"ngIf"],[1,"form",3,"formGroup"],[1,"form-grid"],["for","title",3,"label","readOnlyToggle"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label","readOnlyToggle"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label","readOnlyToggle"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label","readOnlyToggle"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label","readOnlyToggle"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["for","password",3,"label",4,"ngIf"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","customer-detail",3,"entity$","detailForm"],[1,"btn","btn-primary",3,"click","disabled"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"customer"],["class","last-login",3,"label",4,"ngIf"],[1,"last-login",3,"label"],[3,"dateTime"],[3,"title"],[4,"ngIf","ngIfElse"],["class","button-small mt-1",3,"click",4,"vdrIfPermissions"],["icon","times",3,"colorFrom","iconClick",4,"ngFor","ngForOf"],["icon","times",3,"iconClick","colorFrom"],[1,"color-weight-400"],[1,"button-small","mt-1",3,"click"],["shape","plus"],[3,"entity"],["for","password",3,"label"],["id","password","type","password","formControlName","password"],["formGroupName","customFields",3,"title"],["entityName","Customer",3,"customFields","customFieldsFormGroup"],[3,"to-delete","availableCountries","isDefaultBilling","isDefaultShipping","addressForm","customFields","editable","setAsDefaultBilling","setAsDefaultShipping","deleteAddress",4,"ngFor","ngForOf"],["class","btn btn-secondary mt-2",3,"click",4,"vdrIfPermissions"],[3,"title","paddingX"],["id","customer-order-list",3,"itemsPerPageChange","pageChange","items","itemsPerPage","totalItems","currentPage","emptyStateLabel"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","code",3,"heading","optional"],["id","order-type",3,"heading","hiddenByDefault"],["id","state",3,"heading"],["id","total",3,"heading"],["id","updated-at",3,"heading"],["id","placed-at",3,"heading"],[3,"customField",4,"ngFor","ngForOf"],[3,"addNote","updateNote","deleteNote","customer","history"],[3,"setAsDefaultBilling","setAsDefaultShipping","deleteAddress","availableCountries","isDefaultBilling","isDefaultShipping","addressForm","customFields","editable"],[1,"btn","btn-secondary","mt-2",3,"click"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"state"],[3,"customField"]],template:function(t,o){if(1&t&&(e.j41(0,"vdr-page-block")(1,"vdr-action-bar"),e.nrm(2,"vdr-ab-left"),e.j41(3,"vdr-ab-right"),e.nrm(4,"vdr-action-bar-items",2),e.DNE(5,ts,3,4,"button",3),e.nI1(6,"async"),e.DNE(7,ns,1,1,"ng-template",null,0,e.C5r),e.nrm(9,"vdr-action-bar-dropdown-menu",2),e.k0s()()(),e.j41(10,"vdr-page-detail-layout")(11,"vdr-page-detail-sidebar"),e.DNE(12,rs,3,2,"vdr-card",4),e.nI1(13,"async"),e.DNE(14,ls,7,6,"vdr-card",5),e.nI1(15,"async"),e.j41(16,"vdr-card"),e.DNE(17,ds,1,1,"vdr-page-entity-info",6),e.nI1(18,"async"),e.k0s()(),e.j41(19,"vdr-page-block")(20,"form",7)(21,"vdr-card")(22,"div",8)(23,"vdr-form-field",9),e.nI1(24,"translate"),e.nI1(25,"async"),e.nrm(26,"input",10),e.k0s(),e.nrm(27,"div"),e.j41(28,"vdr-form-field",11),e.nI1(29,"translate"),e.nI1(30,"async"),e.nrm(31,"input",12),e.k0s(),e.j41(32,"vdr-form-field",13),e.nI1(33,"translate"),e.nI1(34,"async"),e.nrm(35,"input",14),e.k0s(),e.j41(36,"vdr-form-field",15),e.nI1(37,"translate"),e.nI1(38,"async"),e.nrm(39,"input",16),e.k0s(),e.j41(40,"vdr-form-field",17),e.nI1(41,"translate"),e.nI1(42,"async"),e.nrm(43,"input",18),e.k0s(),e.DNE(44,us,3,3,"vdr-form-field",19),e.nI1(45,"async"),e.k0s()(),e.DNE(46,ps,3,5,"vdr-card",20),e.k0s(),e.nrm(47,"vdr-custom-detail-component-host",21),e.DNE(48,Fs,42,58,"ng-container",4),e.nI1(49,"async"),e.k0s()()),2&t){let r;const i=e.sdS(8);e.R7$(5),e.Y8G("ngIf",e.bMT(6,21,o.isNew$))("ngIfElse",i),e.R7$(7),e.Y8G("ngIf",e.bMT(13,23,o.entity$)),e.R7$(2),e.Y8G("ngIf",null==(r=e.bMT(15,25,o.entity$))?null:r.groups),e.R7$(3),e.Y8G("ngIf",e.bMT(18,27,o.entity$)),e.R7$(3),e.Y8G("formGroup",o.detailForm.get("customer")),e.R7$(3),e.Y8G("label",e.bMT(24,29,"customer.title"))("readOnlyToggle",!e.bMT(25,31,o.isNew$)),e.R7$(5),e.Y8G("label",e.bMT(29,33,"customer.first-name"))("readOnlyToggle",!e.bMT(30,35,o.isNew$)),e.R7$(4),e.Y8G("label",e.bMT(33,37,"customer.last-name"))("readOnlyToggle",!e.bMT(34,39,o.isNew$)),e.R7$(4),e.Y8G("label",e.bMT(37,41,"customer.email-address"))("readOnlyToggle",!e.bMT(38,43,o.isNew$)),e.R7$(4),e.Y8G("label",e.bMT(41,45,"customer.phone-number"))("readOnlyToggle",!e.bMT(42,47,o.isNew$)),e.R7$(4),e.Y8G("ngIf",e.bMT(45,49,o.isNew$)),e.R7$(2),e.Y8G("ngIf",o.customFields.length),e.R7$(),e.Y8G("entity$",o.entity$)("detailForm",o.detailForm),e.R7$(),e.Y8G("ngIf",!e.bMT(49,51,o.isNew$))}},dependencies:[v.U4n,u.Sq,u.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,b.Wk,f.nG,f.wL,f.TX,J.l,X.w,oe.K,W.V,yt.F,Ce.B,M.p,Q.T,re.W,be.L,V.I,L.Y,ie.T,z.e,ve.E,Te.c,Ie.e,ye.i,T,$,N,u.Jj,h.D9,ae.E,Zt.n,H.P,Kt.u],styles:[".last-login[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-500)}.to-delete[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0})}function Rs(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.create())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),e.R7$(),e.SpI(" ",e.bMT(2,2,"common.create")," ")}}function $s(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.save())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),e.R7$(),e.SpI(" ",e.bMT(2,2,"common.update")," ")}}function Es(s,n){1&s&&e.DNE(0,$s,3,4,"button",11),2&s&&e.Y8G("vdrIfPermissions","UpdateCustomer")}function Ss(s,n){if(1&s&&(e.j41(0,"vdr-card"),e.nrm(1,"vdr-page-entity-info",12),e.k0s()),2&s){const t=n.ngIf;e.R7$(),e.Y8G("entity",t)}}function Ms(s,n){if(1&s&&(e.j41(0,"vdr-card",13),e.nI1(1,"translate"),e.nrm(2,"vdr-tabbed-custom-fields",14),e.k0s()),2&s){const t=e.XpG();e.Y8G("title",e.bMT(1,3,"common.custom-fields")),e.R7$(2),e.Y8G("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customFields"))}}const ks=w.J1`
    query GetCustomerGroupDetail($id: ID!) {
        customerGroup(id: $id) {
            ...CustomerGroupDetail
        }
    }
    fragment CustomerGroupDetail on CustomerGroup {
        id
        createdAt
        updatedAt
        name
    }
`;class A extends m.wi7{constructor(n,t,o,r){super(),this.formBuilder=n,this.dataService=t,this.modalService=o,this.notificationService=r,this.customFields=this.getCustomFieldConfig("CustomerGroup"),this.detailForm=this.formBuilder.group({name:"",customFields:this.formBuilder.group((0,m.HCD)(this.customFields))})}ngOnInit(){super.init()}create(){const n=this.detailForm.value;n.name&&this.dataService.customer.createCustomerGroup({name:n.name,customFields:n.customFields,customerIds:[]}).subscribe(({createCustomerGroup:t})=>{this.notificationService.success((0,l.x)("common.notify-create-success"),{entity:"CustomerGroup"}),this.detailForm.markAsPristine(),this.router.navigate(["../",t.id],{relativeTo:this.route})},t=>{this.notificationService.error((0,l.x)("common.notify-create-error"),{entity:"CustomerGroup"})})}save(){const n=this.detailForm.value;this.dataService.customer.updateCustomerGroup({id:this.id,...n}).subscribe(()=>{this.notificationService.success((0,l.x)("common.notify-update-success"),{entity:"CustomerGroup"}),this.detailForm.markAsPristine()},t=>{this.notificationService.error((0,l.x)("common.notify-update-error"),{entity:"CustomerGroup"})})}setFormValues(n){if(this.detailForm.patchValue({name:n.name}),this.customFields.length){this.detailForm.get(["customFields"]);this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),n)}}static#e=this.\u0275fac=function(t){return new(t||A)(e.rXU(c.ok),e.rXU(m.uSP),e.rXU(m.Bg8),e.rXU(m.JEu))};static#t=this.\u0275cmp=e.VBU({type:A,selectors:[["vdr-customer-group-detail"]],features:[e.Vt3],decls:23,vars:14,consts:[["updateButton",""],["locationId","customer-group-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],[1,"form",3,"formGroup"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","customer-group-detail",3,"entity$","detailForm"],[1,"btn","btn-primary",3,"click","disabled"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","CustomerGroup",3,"customFields","customFieldsFormGroup"]],template:function(t,o){if(1&t&&(e.j41(0,"vdr-page-block")(1,"vdr-action-bar"),e.nrm(2,"vdr-ab-left"),e.j41(3,"vdr-ab-right"),e.nrm(4,"vdr-action-bar-items",1),e.DNE(5,Rs,3,4,"button",2),e.nI1(6,"async"),e.DNE(7,Es,1,1,"ng-template",null,0,e.C5r),e.nrm(9,"vdr-action-bar-dropdown-menu",1),e.k0s()()(),e.j41(10,"form",3)(11,"vdr-page-detail-layout")(12,"vdr-page-detail-sidebar"),e.DNE(13,Ss,2,1,"vdr-card",4),e.nI1(14,"async"),e.k0s(),e.j41(15,"vdr-page-block")(16,"vdr-card")(17,"div",5)(18,"vdr-form-field",6),e.nI1(19,"translate"),e.nrm(20,"input",7),e.k0s()()(),e.DNE(21,Ms,3,5,"vdr-card",8),e.nrm(22,"vdr-custom-detail-component-host",9),e.k0s()()()),2&t){const r=e.sdS(8);e.R7$(5),e.Y8G("ngIf",e.bMT(6,8,o.isNew$))("ngIfElse",r),e.R7$(5),e.Y8G("formGroup",o.detailForm),e.R7$(3),e.Y8G("ngIf",e.bMT(14,10,o.entity$)),e.R7$(5),e.Y8G("label",e.bMT(19,12,"common.name")),e.R7$(3),e.Y8G("ngIf",o.customFields.length),e.R7$(),e.Y8G("entity$",o.entity$)("detailForm",o.detailForm)}},dependencies:[u.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,f.nG,f.wL,f.TX,J.l,oe.K,W.V,M.p,Q.T,re.W,be.L,z.e,ve.E,Te.c,Ie.e,ye.i,u.Jj,h.D9],changeDetection:0})}const Ns=()=>["CreateCustomerGroup","UpdateCustomerGroup"];function js(s,n){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"customer.update-customer-group")))}function As(s,n){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"customer.create-customer-group")))}function Ps(s,n){if(1&s&&e.DNE(0,js,3,3,"span",6)(1,As,3,3,"span",6),2&s){const t=e.XpG();e.Y8G("ngIf",t.group.id),e.R7$(),e.Y8G("ngIf",!t.group.id)}}function xs(s,n){if(1&s&&(e.j41(0,"section",7)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"vdr-tabbed-custom-fields",8),e.k0s()),2&s){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"common.custom-fields")),e.R7$(2),e.Y8G("customFields",t.customFields)("customFieldsFormGroup",t.form.get("customFields"))}}function Ys(s,n){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"customer.update-customer-group")))}function Bs(s,n){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"customer.create-customer-group")))}function Os(s,n){if(1&s){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.cancel())}),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"button",10),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.save())}),e.DNE(4,Ys,3,3,"span",6)(5,Bs,3,3,"span",6),e.k0s()}if(2&s){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,4,"common.cancel")),e.R7$(2),e.Y8G("disabled",!t.form.valid),e.R7$(),e.Y8G("ngIf",t.group.id),e.R7$(),e.Y8G("ngIf",!t.group.id)}}class Z{constructor(n,t){this.serverConfigService=n,this.formBuilder=t,this.customFields=this.serverConfigService.getCustomFieldsFor("CustomerGroup")}ngOnInit(){if(this.form=this.formBuilder.group({name:[this.group.name,c.k0.required],customFields:this.formBuilder.group((0,m.HCD)(this.customFields))}),this.customFields.length){const n=this.form.get("customFields");for(const t of this.customFields){const o=t.name,r=this.group.customFields?.[o],i=n.get(o);i&&i.patchValue(r)}}}cancel(){this.resolveWith()}save(){this.resolveWith(this.form.value)}static#e=this.\u0275fac=function(t){return new(t||Z)(e.rXU(m.BBL),e.rXU(c.ze))};static#t=this.\u0275cmp=e.VBU({type:Z,selectors:[["vdr-customer-group-detail-dialog"]],decls:8,vars:9,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["vdrDialogButtons",""],[4,"ngIf"],["formGroupName","customFields"],["entityName","CustomerGroup",3,"customFields","customFieldsFormGroup"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,o){1&t&&(e.DNE(0,Ps,2,2,"ng-template",0),e.j41(1,"form",1)(2,"vdr-form-field",2),e.nI1(3,"translate"),e.nrm(4,"input",3),e.nI1(5,"hasPermission"),e.k0s(),e.DNE(6,xs,5,5,"section",4),e.k0s(),e.DNE(7,Os,6,6,"ng-template",5)),2&t&&(e.R7$(),e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("label",e.bMT(3,4,"common.name")),e.R7$(2),e.Y8G("readonly",!e.bMT(5,6,e.lJ4(8,Ns))),e.R7$(2),e.Y8G("ngIf",o.customFields.length))},dependencies:[v.aZZ,u.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,oe.K,W.V,Y.b,B.M,re.W,h.D9,ae.E],changeDetection:0})}const Re=(0,m.AfA)({location:"customer-group-list",requiresPermission:s=>s.includes(m.aXG.DeleteCustomerGroup),getItemName:s=>s.name,bulkDelete:(s,n)=>s.customer.deleteCustomerGroups(n).pipe((0,p.T)(t=>t.deleteCustomerGroups))});var Us=a(7453),Vs=a(6107),Ls=a(2086),$e=a(5316);const Xs=()=>["./","create"],Ee=s=>["./",s],Hs=s=>({contents:s}),ws=s=>({groupName:s});function Js(s,n){1&s&&(e.j41(0,"a",5),e.nrm(1,"clr-icon",6),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.Y8G("routerLink",e.lJ4(4,Xs)),e.R7$(2),e.SpI(" ",e.bMT(3,2,"customer.create-new-customer-group")," "))}function Ws(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.id," ")}}function Qs(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.createdAt,"short")," ")}}function zs(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.updatedAt,"short")," ")}}function Zs(s,n){if(1&s&&(e.j41(0,"a",16)(1,"span"),e.EFF(2),e.k0s(),e.nrm(3,"clr-icon",17),e.k0s()),2&s){const t=n.item;e.Y8G("routerLink",e.eq3(2,Ee,t.id)),e.R7$(2),e.JRh(t.name)}}function Ks(s,n){if(1&s&&e.nrm(0,"vdr-dt2-custom-field-column",18),2&s){const t=n.$implicit,o=e.XpG(2);e.Y8G("customField",t)("sorts",o.sorts)}}function qs(s,n){if(1&s&&(e.j41(0,"a",19)(1,"span"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"clr-icon",20),e.k0s()),2&s){const t=n.item;e.Y8G("routerLink",e.eq3(6,Ee,e.eq3(4,Hs,t.id))),e.R7$(2),e.JRh(e.bMT(3,2,"customer.view-group-members"))}}function en(s,n){if(1&s){const t=e.RV6();e.j41(0,"vdr-data-table-2",7),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bIt("pageChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.setPageNumber(r))})("itemsPerPageChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.setItemsPerPage(r))})("visibleColumnsChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.setVisibleColumns(r))}),e.nrm(6,"vdr-bulk-action-menu",8)(7,"vdr-dt2-search",9),e.nI1(8,"translate"),e.j41(9,"vdr-dt2-column",10),e.nI1(10,"translate"),e.DNE(11,Ws,1,1,"ng-template"),e.k0s(),e.j41(12,"vdr-dt2-column",11),e.nI1(13,"translate"),e.DNE(14,Qs,2,4,"ng-template"),e.k0s(),e.j41(15,"vdr-dt2-column",12),e.nI1(16,"translate"),e.DNE(17,zs,2,4,"ng-template"),e.k0s(),e.j41(18,"vdr-dt2-column",13),e.nI1(19,"translate"),e.DNE(20,Zs,4,4,"ng-template"),e.k0s(),e.DNE(21,Ks,1,2,"vdr-dt2-custom-field-column",14),e.j41(22,"vdr-dt2-column",15),e.nI1(23,"translate"),e.DNE(24,qs,5,8,"ng-template"),e.k0s()()}if(2&s){const t=e.XpG();e.Y8G("id",t.dataTableListId)("items",e.bMT(1,25,t.items$))("itemsPerPage",e.bMT(2,27,t.itemsPerPage$))("totalItems",e.bMT(3,29,t.totalItems$))("currentPage",e.bMT(4,31,t.currentPage$))("filters",t.filters)("activeIndex",e.bMT(5,33,t.activeIndex$)),e.R7$(6),e.Y8G("hostComponent",t)("selectionManager",t.selectionManager),e.R7$(),e.Y8G("searchTermControl",t.searchTermControl)("searchTermPlaceholder",e.bMT(8,35,"common.search-by-name")),e.R7$(2),e.Y8G("heading",e.bMT(10,37,"common.id"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(13,39,"common.created-at"))("hiddenByDefault",!0)("sort",t.sorts.get("createdAt")),e.R7$(3),e.Y8G("heading",e.bMT(16,41,"common.updated-at"))("hiddenByDefault",!0)("sort",t.sorts.get("updatedAt")),e.R7$(3),e.Y8G("heading",e.bMT(19,43,"common.name"))("optional",!1)("sort",t.sorts.get("name")),e.R7$(3),e.Y8G("ngForOf",t.customFields),e.R7$(),e.Y8G("heading",e.bMT(23,45,"common.view-contents"))("optional",!1)}}function tn(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",22),e.bIt("click",function(){const r=e.eBV(t).ngIf,i=e.XpG(2);return e.Njj(i.addToGroup(r))}),e.nrm(2,"clr-icon",6),e.j41(3,"span"),e.EFF(4),e.nI1(5,"translate"),e.k0s()(),e.j41(6,"vdr-customer-group-member-list",23),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.bIt("fetchParamsChange",function(r){e.eBV(t);const i=e.XpG(2);return e.Njj(i.fetchGroupMembers$.next(r))}),e.k0s(),e.bVm()}if(2&s){const t=n.ngIf,o=e.XpG(2);e.R7$(4),e.JRh(e.i5U(5,5,"customer.add-customers-to-group",e.eq3(14,ws,t.name))),e.R7$(2),e.Y8G("members",e.bMT(7,8,o.members$))("route",o.route)("totalItems",e.bMT(8,10,o.membersTotal$))("activeGroup",e.bMT(9,12,o.activeGroup$))}}function sn(s,n){if(1&s&&(e.DNE(0,tn,10,16,"ng-container",21),e.nI1(1,"async")),2&s){const t=e.XpG();e.Y8G("ngIf",e.bMT(1,1,t.activeGroup$))}}const nn=w.J1`
    query GetCustomerGroupList($options: CustomerGroupListOptions) {
        customerGroups(options: $options) {
            items {
                ...CustomerGroup
            }
            totalItems
        }
    }
    ${m.QaK}
`;class P extends m.B8I{constructor(n,t,o,r,i){super(),this.dataService=n,this.notificationService=t,this.modalService=o,this.route=r,this.router=i,this.dataTableListId="customer-group-list",this.customFields=this.getCustomFieldConfig("CustomerGroup"),this.fetchGroupMembers$=new F.t({skip:0,take:0,filterTerm:""}),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"name",type:{kind:"text"},label:(0,l.x)("common.name"),filterField:"name"}).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"name"}).connectToRoute(this.route),this.refreshActiveGroupMembers$=new F.t(void 0),super.configure({document:m.DUl,getItems:d=>d.customerGroups,setVariables:(d,_)=>({options:{skip:d,take:_,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}ngOnInit(){super.ngOnInit();const n=this.route.paramMap.pipe((0,p.T)(o=>o.get("contents")),(0,ee.F)());this.listIsEmpty$=this.items$.pipe((0,p.T)(o=>0===o.length)),this.activeGroup$=(0,O.z)(this.items$,n).pipe((0,p.T)(([o,r])=>{if(r)return o.find(i=>i.id===r)})),this.activeIndex$=(0,O.z)(this.items$,n).pipe((0,p.T)(([o,r])=>r?o.findIndex(i=>i.id===r):-1));const t=(0,O.z)(this.activeGroup$,this.fetchGroupMembers$,this.refreshActiveGroupMembers$).pipe((0,C.n)(([o,{skip:r,take:i,filterTerm:d}])=>o?this.dataService.customer.getCustomerGroupWithCustomers(o.id,{skip:r,take:i,filter:{emailAddress:{contains:d}}}).mapStream(_=>_.customerGroup?.customers):(0,Us.of)(void 0)));this.members$=t.pipe((0,p.T)(o=>o?.items??[])),this.membersTotal$=t.pipe((0,p.T)(o=>o?.totalItems??0))}closeMembers(){const n={...this.route.snapshot.params};delete n.contents,this.router.navigate(["./",n],{relativeTo:this.route,queryParamsHandling:"preserve"})}addToGroup(n){this.modalService.fromComponent(D,{locals:{group:n,route:this.route},size:"md",verticalAlign:"top"}).pipe((0,C.n)(t=>t?this.dataService.customer.addCustomersToGroup(n.id,t).pipe((0,Vs.u)(t)):E.w)).subscribe({next:t=>{this.notificationService.success((0,l.x)("customer.add-customers-to-group-success"),{customerCount:t.length,groupName:n.name}),this.refreshActiveGroupMembers$.next()}})}static#e=this.\u0275fac=function(t){return new(t||P)(e.rXU(m.uSP),e.rXU(m.JEu),e.rXU(m.Bg8),e.rXU(b.nX),e.rXU(b.Ix))};static#t=this.\u0275cmp=e.VBU({type:P,selectors:[["vdr-customer-group-list"]],features:[e.Vt3],decls:12,vars:7,consts:[["locationId","customer-group-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"closeClicked","rightPanelOpen"],["vdrSplitViewLeft",""],["vdrSplitViewRight","",3,"splitViewTitle"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"mt-2",3,"pageChange","itemsPerPageChange","visibleColumnsChange","id","items","itemsPerPage","totalItems","currentPage","filters","activeIndex"],["locationId","customer-group-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],[3,"customField","sorts",4,"ngFor","ngForOf"],["id","view-contents",3,"heading","optional"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customField","sorts"],["queryParamsHandling","preserve",1,"button-small","bg-weight-150",3,"routerLink"],["shape","file-group"],[4,"ngIf"],[1,"button-ghost","ml-4",3,"click"],["locationId","customer-group-members-list",3,"fetchParamsChange","members","route","totalItems","activeGroup"]],template:function(t,o){if(1&t&&(e.j41(0,"vdr-page-block")(1,"vdr-action-bar"),e.nrm(2,"vdr-ab-left"),e.j41(3,"vdr-ab-right"),e.nrm(4,"vdr-action-bar-items",0),e.DNE(5,Js,4,5,"a",1),e.nrm(6,"vdr-action-bar-dropdown-menu",0),e.k0s()()(),e.j41(7,"vdr-split-view",2),e.nI1(8,"async"),e.bIt("closeClicked",function(){return o.closeMembers()}),e.DNE(9,en,25,47,"ng-template",3)(10,sn,2,3,"ng-template",4),e.nI1(11,"async"),e.k0s()),2&t){let r;e.R7$(5),e.Y8G("vdrIfPermissions","CreateCustomerGroup"),e.R7$(2),e.Y8G("rightPanelOpen",e.bMT(8,3,o.activeGroup$)),e.R7$(3),e.Y8G("splitViewTitle",null==(r=e.bMT(11,5,o.activeGroup$))?null:r.name)}},dependencies:[v.U4n,u.Sq,u.bT,b.Wk,f.nG,f.wL,f.TX,J.l,M.p,Q.T,te.T,V.I,L.Y,se.E,ie.T,Ls.l,$e.w,$e.P,z.e,I,u.Jj,h.D9,H.P],styles:["vdr-empty-placeholder[_ngcontent-%COMP%]{flex:1}"],changeDetection:0})}const Se={location:"customer-group-members-list",label:(0,l.x)("customer.remove-from-group"),icon:"trash",iconClass:"is-danger",requiresPermission:m.aXG.UpdateCustomerGroup,onClick:({injector:s,selection:n,hostComponent:t,clearSelection:o})=>{s.get(m.Bg8);const i=s.get(m.uSP),d=s.get(m.JEu),_=t.activeGroup,g=n.map(G=>G.id);i.customer.removeCustomersFromGroup(_.id,g).subscribe({complete:()=>{d.success((0,l.x)("customer.remove-customers-from-group-success"),{customerCount:g.length,groupName:_.name}),o(),t.refresh()}})}},Me=(0,m.AfA)({location:"customer-list",requiresPermission:s=>s.includes(m.aXG.DeleteCustomer),getItemName:s=>s.firstName+" "+s.lastName,bulkDelete:(s,n)=>s.customer.deleteCustomers(n).pipe((0,p.T)(t=>t.deleteCustomers))}),on=()=>["./create"],rn=s=>["./",s];function an(s,n){1&s&&(e.j41(0,"a",12),e.nrm(1,"clr-icon",13),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.Y8G("routerLink",e.lJ4(4,on)),e.R7$(2),e.SpI(" ",e.bMT(3,2,"customer.create-new-customer")," "))}function mn(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.id," ")}}function cn(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.createdAt,"short")," ")}}function ln(s,n){if(1&s&&(e.EFF(0),e.nI1(1,"localeDate")),2&s){const t=n.item;e.SpI(" ",e.i5U(1,1,t.updatedAt,"short")," ")}}function dn(s,n){if(1&s&&(e.j41(0,"a",14)(1,"span"),e.EFF(2),e.k0s(),e.nrm(3,"clr-icon",15),e.k0s()),2&s){const t=n.item;e.Y8G("routerLink",e.eq3(4,rn,t.id)),e.R7$(2),e.E5c(" ",t.title," ",t.firstName," ",t.lastName," ")}}function un(s,n){if(1&s&&e.nrm(0,"vdr-customer-status-label",16),2&s){const t=n.item;e.Y8G("customer",t)}}function pn(s,n){if(1&s&&e.EFF(0),2&s){const t=n.item;e.SpI(" ",t.emailAddress," ")}}function _n(s,n){if(1&s&&e.nrm(0,"vdr-dt2-custom-field-column",17),2&s){const t=n.$implicit,o=e.XpG();e.Y8G("customField",t)("sorts",o.sorts)}}const gn=w.J1`
    query CustomerListQuery($options: CustomerListOptions) {
        customers(options: $options) {
            items {
                ...CustomerListItem
            }
            totalItems
        }
    }

    fragment CustomerListItem on Customer {
        id
        createdAt
        updatedAt
        title
        firstName
        lastName
        emailAddress
        user {
            id
            verified
        }
    }
`;class x extends m.B8I{constructor(){super(),this.dataTableListId="customer-list",this.customFields=this.getCustomFieldConfig("Customer"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"firstName",type:{kind:"text"},label:(0,l.x)("customer.first-name"),filterField:"firstName"}).addFilter({name:"lastName",type:{kind:"text"},label:(0,l.x)("customer.last-name"),filterField:"lastName"}).addFilter({name:"emailAddress",type:{kind:"text"},label:(0,l.x)("customer.email-address"),filterField:"emailAddress"}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"lastName"}).addSort({name:"emailAddress"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.configure({document:m.S57,getItems:n=>n.customers,setVariables:(n,t)=>({options:{skip:n,take:t,filter:{...this.searchTermControl.value?{emailAddress:{contains:this.searchTermControl.value},lastName:{contains:this.searchTermControl.value},postalCode:{contains:this.searchTermControl.value}}:{},...this.filters.createFilterInput()},filterOperator:this.searchTermControl.value?m.umn.OR:m.umn.AND,sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.sorts.valueChanges,this.filters.valueChanges]})}static#e=this.\u0275fac=function(t){return new(t||x)};static#t=this.\u0275cmp=e.VBU({type:x,selectors:[["vdr-customer-list"]],features:[e.Vt3],decls:34,vars:48,consts:[["locationId","customer-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"mt-2",3,"pageChange","itemsPerPageChange","visibleColumnsChange","id","items","itemsPerPage","totalItems","currentPage","filters"],["locationId","customer-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],["id","status",3,"heading"],["id","email-address",3,"heading","sort"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer"],[3,"customField","sorts"]],template:function(t,o){1&t&&(e.j41(0,"vdr-page-block")(1,"vdr-action-bar"),e.nrm(2,"vdr-ab-left"),e.j41(3,"vdr-ab-right"),e.nrm(4,"vdr-action-bar-items",0),e.DNE(5,an,4,5,"a",1),e.nrm(6,"vdr-action-bar-dropdown-menu",0),e.k0s()()(),e.j41(7,"vdr-data-table-2",2),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.bIt("pageChange",function(i){return o.setPageNumber(i)})("itemsPerPageChange",function(i){return o.setItemsPerPage(i)})("visibleColumnsChange",function(i){return o.setVisibleColumns(i)}),e.nrm(12,"vdr-bulk-action-menu",3)(13,"vdr-dt2-search",4),e.nI1(14,"translate"),e.j41(15,"vdr-dt2-column",5),e.nI1(16,"translate"),e.DNE(17,mn,1,1,"ng-template"),e.k0s(),e.j41(18,"vdr-dt2-column",6),e.nI1(19,"translate"),e.DNE(20,cn,2,4,"ng-template"),e.k0s(),e.j41(21,"vdr-dt2-column",7),e.nI1(22,"translate"),e.DNE(23,ln,2,4,"ng-template"),e.k0s(),e.j41(24,"vdr-dt2-column",8),e.nI1(25,"translate"),e.DNE(26,dn,4,6,"ng-template"),e.k0s(),e.j41(27,"vdr-dt2-column",9),e.nI1(28,"translate"),e.DNE(29,un,1,1,"ng-template"),e.k0s(),e.j41(30,"vdr-dt2-column",10),e.nI1(31,"translate"),e.DNE(32,pn,1,1,"ng-template"),e.k0s(),e.DNE(33,_n,1,2,"vdr-dt2-custom-field-column",11),e.k0s()),2&t&&(e.R7$(5),e.Y8G("vdrIfPermissions","CreateCustomer"),e.R7$(2),e.Y8G("id",o.dataTableListId)("items",e.bMT(8,26,o.items$))("itemsPerPage",e.bMT(9,28,o.itemsPerPage$))("totalItems",e.bMT(10,30,o.totalItems$))("currentPage",e.bMT(11,32,o.currentPage$))("filters",o.filters),e.R7$(5),e.Y8G("hostComponent",o)("selectionManager",o.selectionManager),e.R7$(),e.Y8G("searchTermControl",o.searchTermControl)("searchTermPlaceholder",e.bMT(14,34,"customer.search-customers-by-email-last-name-postal-code")),e.R7$(2),e.Y8G("heading",e.bMT(16,36,"common.id"))("hiddenByDefault",!0),e.R7$(3),e.Y8G("heading",e.bMT(19,38,"common.created-at"))("hiddenByDefault",!0)("sort",o.sorts.get("createdAt")),e.R7$(3),e.Y8G("heading",e.bMT(22,40,"common.updated-at"))("hiddenByDefault",!0)("sort",o.sorts.get("updatedAt")),e.R7$(3),e.Y8G("heading",e.bMT(25,42,"customer.name"))("optional",!1)("sort",o.sorts.get("lastName")),e.R7$(3),e.Y8G("heading",e.bMT(28,44,"common.status")),e.R7$(3),e.Y8G("heading",e.bMT(31,46,"customer.email-address"))("sort",o.sorts.get("emailAddress")),e.R7$(3),e.Y8G("ngForOf",o.customFields))},dependencies:[v.U4n,u.Sq,b.Wk,f.nG,f.wL,f.TX,J.l,M.p,Q.T,te.T,V.I,L.Y,se.E,ie.T,z.e,T,u.Jj,h.D9,H.P],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]})}const ke=s=>[{path:"customers",component:m.H1b,data:{locationId:"customer-list",breadcrumb:(0,l.x)("breadcrumb.customers")},children:s.getPageTabRoutes("customer-list")},{path:"customers/:id",component:m.H1b,data:{locationId:"customer-detail",breadcrumb:{label:(0,l.x)("breadcrumb.customers"),link:["../","customers"]}},children:s.getPageTabRoutes("customer-detail")},{path:"groups",component:m.H1b,data:{locationId:"customer-group-list",breadcrumb:(0,l.x)("breadcrumb.customer-groups")},children:s.getPageTabRoutes("customer-group-list")},{path:"groups/:id",component:m.H1b,data:{locationId:"customer-group-detail",breadcrumb:{label:(0,l.x)("breadcrumb.customer-groups"),link:["../","groups"]}},children:s.getPageTabRoutes("customer-group-detail")}];function hn(s,n){return(0,m.bv4)({entity:s.entity,id:n.id,breadcrumbKey:"breadcrumb.customers",getName:t=>`${t.firstName} ${t.lastName}`,route:"customers"})}class y{static#e=this.hasRegisteredTabsAndBulkActions=!1;constructor(n,t){y.hasRegisteredTabsAndBulkActions||(n.registerBulkAction(Me),n.registerBulkAction(Re),n.registerBulkAction(Se),t.registerPageTab({priority:0,location:"customer-list",tab:(0,l.x)("customer.customers"),route:"",component:x}),t.registerPageTab({priority:0,location:"customer-detail",tab:(0,l.x)("customer.customer"),route:"",component:(0,m.HL6)({component:j,query:m.L7M,entityKey:"customer",variables:{orderListOptions:{sort:{orderPlacedAt:m.xBQ.DESC}}},getBreadcrumbs:o=>[{label:o?`${o?.firstName} ${o?.lastName}`:(0,l.x)("customer.create-new-customer"),link:[o?.id]}]})}),t.registerPageTab({priority:0,location:"customer-group-list",tab:(0,l.x)("customer.customer-groups"),route:"",component:P}),t.registerPageTab({priority:0,location:"customer-group-detail",tab:(0,l.x)("customer.customer-group"),route:"",component:(0,m.HL6)({component:A,query:m.U6p,entityKey:"customerGroup",getBreadcrumbs:o=>[{label:o?o.name:(0,l.x)("customer.create-new-customer-group"),link:[o?.id]}]})}),y.hasRegisteredTabsAndBulkActions=!0)}static#t=this.\u0275fac=function(t){return new(t||y)(e.KVO(m.HCh),e.KVO(m.bPm))};static#s=this.\u0275mod=e.$C({type:y});static#n=this.\u0275inj=e.G2t({providers:[{provide:b.bw,useFactory:n=>ke(n),multi:!0,deps:[m.bPm]}],imports:[m.GgS,b.iI.forChild([])]})}}}]);
//# sourceMappingURL=983.5c4a8237d67b9976.js.map